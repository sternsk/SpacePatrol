/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={412:(t,e)=>{"use strict";function n(t,e,n){void 0===n&&(n="ticks");var s=0,i=t.length,r=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;s<r;){var o=Math.floor(s+(r-s)/2),a=t[o],c=t[o+1];if(a[n]===e){for(var u=o;u<t.length;u++)t[u][n]===e&&(o=u);return o}if(a[n]<e&&c[n]>e)return o;a[n]>e?r=o:a[n]<e&&(s=o+1)}return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.insert=e.search=void 0,e.search=n,e.insert=function(t,e,s){if(void 0===s&&(s="ticks"),t.length){var i=n(t,e[s],s);t.splice(i+1,0,e)}else t.push(e)}},796:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce((function(t,n){return t[e.controlChangeNames[n]]=n,t}),{});var n=new WeakMap,s=new WeakMap,i=function(){function t(t,e){n.set(this,e),s.set(this,t.controllerType),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"number",{get:function(){return s.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},t}();e.ControlChange=i},651:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createControlChanges=void 0;var s=n(796);e.createControlChanges=function(){return new Proxy({},{get:function(t,e){return t[e]?t[e]:s.controlChangeIds.hasOwnProperty(e)?t[s.controlChangeIds[e]]:void 0},set:function(t,e,n){return s.controlChangeIds.hasOwnProperty(e)?t[s.controlChangeIds[e]]=n:t[e]=n,!0}})}},547:function(t,e,n){"use strict";var s=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var s,i=0,r=e.length;i<r;i++)!s&&i in e||(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var i=n(965),r=n(660),o=n(959);function a(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(127*t.value)}}function c(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}e.encode=function(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:s([s(s(s(s([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map((function(t){return function(t){var e=r.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:"major"===t.scale?0:1,type:"keySignature"}}(t)})),!0),t.header.meta.map((function(t){return{absoluteTime:(e=t).ticks,deltaTime:0,meta:!0,text:e.text,type:e.type};var e})),!0),t.header.tempos.map((function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}(t)})),!0),t.header.timeSignatures.map((function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(t)})),!0)],t.tracks.map((function(t){return s(s(s([(e=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}),c(t)],function(t){return(0,o.flatten)(t.notes.map((function(e){return function(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(127*t.velocity)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(127*t.noteOffVelocity)}]}(e,t.channel)})))}(t),!0),function(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach((function(n){e.push(a(n,t.channel))}));return e}(t),!0),function(t){var e=[];return t.pitchBends.forEach((function(n){e.push(function(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}(n,t.channel))})),e}(t),!0);var e})),!0)};return e.tracks=e.tracks.map((function(t){t=t.sort((function(t,e){return t.absoluteTime-e.absoluteTime}));var e=0;return t.forEach((function(t){t.deltaTime=t.absoluteTime-e,e=t.absoluteTime,delete t.absoluteTime})),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t})),new Uint8Array((0,i.writeMidi)(e))}},660:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var s=n(412),i=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function t(t){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),t){i.set(this,t.header.ticksPerBeat),t.tracks.forEach((function(t){t.forEach((function(t){t.meta&&("timeSignature"===t.type?n.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?n.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&n.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))}))}));var s=0;t.tracks[0].forEach((function(t){s+=t.deltaTime,t.meta&&("trackName"===t.type?n.name=t.text:"text"!==t.type&&"cuePoint"!==t.type&&"marker"!==t.type&&"lyrics"!==t.type||n.meta.push({text:t.text,ticks:s,type:t.type}))})),this.update()}}return t.prototype.update=function(){var t=this,e=0,n=0;this.tempos.sort((function(t,e){return t.ticks-e.ticks})),this.tempos.forEach((function(s,i){var r=i>0?t.tempos[i-1].bpm:t.tempos[0].bpm,o=s.ticks/t.ppq-n,a=60/r*o;s.time=a+e,e=s.time,n+=o})),this.timeSignatures.sort((function(t,e){return t.ticks-e.ticks})),this.timeSignatures.forEach((function(e,n){var s=n>0?t.timeSignatures[n-1]:t.timeSignatures[0],i=(e.ticks-s.ticks)/t.ppq/s.timeSignature[0]/(s.timeSignature[1]/4);s.measures=s.measures||0,e.measures=i+s.measures}))},t.prototype.ticksToSeconds=function(t){var e=(0,s.search)(this.tempos,t);if(-1!==e){var n=this.tempos[e],i=n.time,r=(t-n.ticks)/this.ppq;return i+60/n.bpm*r}return t/this.ppq*.5},t.prototype.ticksToMeasures=function(t){var e=(0,s.search)(this.timeSignatures,t);if(-1!==e){var n=this.timeSignatures[e],i=(t-n.ticks)/this.ppq;return n.measures+i/(n.timeSignature[0]/n.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=(0,s.search)(this.tempos,t,"time");if(-1!==e){var n=this.tempos[e],i=(t-n.time)/(60/n.bpm);return Math.round(n.ticks+i*this.ppq)}var r=t/.5;return Math.round(r*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(t){return{bpm:t.bpm,ticks:t.ticks}})),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map((function(t){return Object.assign({},t)})),this.timeSignatures=t.timeSignatures.map((function(t){return Object.assign({},t)})),this.keySignatures=t.keySignatures.map((function(t){return Object.assign({},t)})),this.meta=t.meta.map((function(t){return Object.assign({},t)})),i.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}();e.Header=r},980:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instrument=void 0;var s=n(659),i=new WeakMap,r=function(){function t(t,e){if(this.number=0,i.set(this,e),this.number=0,t){var n=t.find((function(t){return"programChange"===t.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?s.DrumKitByPatchID[this.number]:s.instrumentByPatchID[this.number]},set:function(t){var e=s.instrumentByPatchID.indexOf(t);-1!==e&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":s.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){return 9===i.get(this).channel},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(t){this.number=t.number},t}();e.Instrument=r},659:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrumKitByPatchID=e.InstrumentFamilyByID=e.instrumentByPatchID=void 0,e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},748:function(t,e,n){"use strict";var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,s,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(i=2&r[0]?s.return:r[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var r=n(965),o=n(660),a=n(710),c=n(547),u=function(){function t(t){var e=this,n=null;if(t){var s=t instanceof ArrayBuffer?new Uint8Array(t):t;(n=(0,r.parseMidi)(s)).tracks.forEach((function(t){var e=0;t.forEach((function(t){e+=t.deltaTime,t.absoluteTime=e}))})),n.tracks=function(t){for(var e=[],n=0;n<t.length;n++)for(var s=e.length,i=new Map,r=Array(16).fill(0),o=0,a=t[n];o<a.length;o++){var c=a[o],u=s,l=c.channel;if(void 0!==l){"programChange"===c.type&&(r[l]=c.programNumber);var h=r[l],p="".concat(h," ").concat(l);i.has(p)?u=i.get(p):(u=s+i.size,i.set(p,u))}e[u]||e.push([]),e[u].push(c)}return e}(n.tracks)}this.header=new o.Header(n),this.tracks=[],t&&(this.tracks=n.tracks.map((function(t){return new a.Track(t,e.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return t.fromUrl=function(e){return s(this,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return[4,fetch(e)];case 1:return(n=s.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new t(s.sent())];case 3:throw new Error("Could not load '".concat(e,"'"))}}))}))},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=this.tracks.map((function(t){return t.duration}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var t=this.tracks.map((function(t){return t.durationTicks}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(){var t=new a.Track(void 0,this.header);return this.tracks.push(t),t},t.prototype.toArray=function(){return(0,c.encode)(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(t){return t.toJSON()}))}},t.prototype.fromJSON=function(t){var e=this;this.header=new o.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map((function(t){var n=new a.Track(void 0,e.header);return n.fromJSON(t),n}))},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}();e.Midi=u;var l=n(710);Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var h=n(660);Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return h.Header}})},445:(t,e)=>{"use strict";function n(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}Object.defineProperty(e,"__esModule",{value:!0}),e.Note=void 0;var s,i,r=(s=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(t){var e=s.exec(t),n=e[1],r=e[2];return i[n.toLowerCase()]+12*(parseInt(r,10)+1)}),o=new WeakMap,a=function(){function t(t,e,n){o.set(this,n),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=e.velocity,this.ticks=t.ticks,this.durationTicks=e.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return t=this.midi,e=Math.floor(t/12)-1,n(t)+e.toString();var t,e},set:function(t){this.midi=r(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var e=t-this.octave;this.midi+=12*e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return n(this.midi)},set:function(t){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this).secondsToTicks(this.time+t);this.durationTicks=e-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return o.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){return o.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();e.Note=a},996:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitchBend=void 0;var n=new WeakMap,s=function(){function t(t,e){n.set(this,e),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();e.PitchBend=s},710:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var s=n(412),i=n(796),r=n(651),o=n(996),a=n(980),c=n(445),u=new WeakMap,l=function(){function t(t,e){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,r.createControlChanges)(),this.pitchBends=[],u.set(this,e),t){var s=t.find((function(t){return"trackName"===t.type}));this.name=s?s.text:""}if(this.instrument=new a.Instrument(t,this),this.channel=0,t){for(var i=t.filter((function(t){return"noteOn"===t.type})),o=t.filter((function(t){return"noteOff"===t.type})),c=function(){var t=i.shift();l.channel=t.channel;var e=o.findIndex((function(e){return e.noteNumber===t.noteNumber&&e.absoluteTime>=t.absoluteTime}));if(-1!==e){var n=o.splice(e,1)[0];l.addNote({durationTicks:n.absoluteTime-t.absoluteTime,midi:t.noteNumber,noteOffVelocity:n.velocity/127,ticks:t.absoluteTime,velocity:t.velocity/127})}},l=this;i.length;)c();t.filter((function(t){return"controller"===t.type})).forEach((function(t){n.addCC({number:t.controllerType,ticks:t.absoluteTime,value:t.value/127})})),t.filter((function(t){return"pitchBend"===t.type})).forEach((function(t){n.addPitchBend({ticks:t.absoluteTime,value:t.value/Math.pow(2,13)})}));var h=t.find((function(t){return"endOfTrack"===t.type}));this.endOfTrackTicks=void 0!==h?h.absoluteTime:void 0}}return t.prototype.addNote=function(t){var e=u.get(this),n=new c.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},e);return Object.assign(n,t),(0,s.insert)(this.notes,n,"ticks"),this},t.prototype.addCC=function(t){var e=u.get(this),n=new i.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(n,t),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),(0,s.insert)(this.controlChanges[n.number],n,"ticks"),this},t.prototype.addPitchBend=function(t){var e=u.get(this),n=new o.PitchBend({},e);return Object.assign(n,t),(0,s.insert)(this.pitchBends,n,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,e=0;e<this.notes.length-1;e++){var n=this.notes[e].time+this.notes[e].duration;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,e=0;e<this.notes.length-1;e++){var n=this.notes[e].ticks+this.notes[e].durationTicks;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(t){var e=this;for(var n in this.name=t.name,this.channel=t.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),void 0!==t.endOfTrackTicks&&(this.endOfTrackTicks=t.endOfTrackTicks),t.controlChanges)t.controlChanges[n]&&t.controlChanges[n].forEach((function(t){e.addCC({number:t.number,ticks:t.ticks,value:t.value})}));t.notes.forEach((function(t){e.addNote({durationTicks:t.durationTicks,midi:t.midi,ticks:t.ticks,velocity:t.velocity})}))},t.prototype.toJSON=function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map((function(t){return t.toJSON()})));var n={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map((function(t){return t.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(t){return t.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},t}();e.Track=l},959:(t,e,n)=>{"use strict";function s(t){var e=[];return i(t,e),e}function i(t,e){for(var n=0;n<t.length;n++){var s=t[n];Array.isArray(s)?i(s,e):e.push(s)}}n.r(e),n.d(e,{flatten:()=>s})},795:function(t,e,n){!function(t,e,n,s){"use strict";var i=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},r=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},o=function(t,e){return{startTime:e,type:"setValue",value:t}},a=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},c=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},u=function(t){return"exponentialRampToValue"===t.type},l=function(t){return"linearRampToValue"===t.type},h=function(t){return u(t)||l(t)},p=function(t){return"setValue"===t.type},d=function(t){return"setValueCurve"===t.type},m=function t(e,n,s,i){var r=e[n];return void 0===r?i:h(r)||p(r)?r.value:d(r)?r.values[r.values.length-1]:c(s,t(e,n-1,r.startTime,i),r)},f=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:h(n)?[n.endTime,n.value]:p(n)?[n.startTime,n.value]:d(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,m(t,e-1,n.startTime,i)]},g=function(t){return"cancelAndHold"===t.type},_=function(t){return"cancelScheduledValues"===t.type},v=function(t){return g(t)||_(t)?t.cancelTime:u(t)||l(t)?t.endTime:t.startTime},y=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},w=function(t,e,n,s){return n+(t-e)/(s.endTime-e)*(s.value-n)},b=function(t,e){var n=e.duration,s=e.startTime,i=e.values;return function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]}(i,(t-s)/n*(i.length-1))},x=function(t){return"setTarget"===t.type},T=function(){return s((function t(e){n(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}),[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=v(t);if(g(t)||_(t)){var n=this._automationEvents.findIndex((function(n){return _(t)&&d(n)?n.startTime+n.duration>=e:v(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),g(t)){var c=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&h(s)){if(void 0!==c&&x(c))throw new Error("The internal list is malformed.");var p=void 0===c?s.insertTime:d(c)?c.startTime+c.duration:v(c),m=void 0===c?this._defaultValue:d(c)?c.values[c.values.length-1]:c.value,f=u(s)?y(e,p,m,s):w(e,p,m,s),b=u(s)?i(f,e,this._currenTime):r(f,e,this._currenTime);this._automationEvents.push(b)}if(void 0!==c&&x(c)&&this._automationEvents.push(o(this.getValue(e),e)),void 0!==c&&d(c)&&c.startTime+c.duration>e){var T=e-c.startTime,k=(c.values.length-1)/c.duration,C=Math.max(2,1+Math.ceil(T*k)),A=T/(C-1)*k,S=c.values.slice(0,C);if(A<1)for(var O=1;O<C;O+=1){var M=A*O%1;S[O]=c.values[O-1]*(1-M)+c.values[O]*M}this._automationEvents[this._automationEvents.length-1]=a(S,c.startTime,T)}}}else{var I=this._automationEvents.findIndex((function(t){return v(t)>e})),E=-1===I?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[I-1];if(void 0!==E&&d(E)&&v(E)+E.duration>e)return!1;var D=u(t)?i(t.value,t.endTime,this._currenTime):l(t)?r(t.value,e,this._currenTime):t;if(-1===I)this._automationEvents.push(D);else{if(d(t)&&e+t.duration>v(this._automationEvents[I]))return!1;this._automationEvents.splice(I,0,D)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return v(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];x(s)&&n.unshift(o(m(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var n=this._automationEvents.findIndex((function(e){return v(e)>t})),s=this._automationEvents[n],i=(-1===n?this._automationEvents.length:n)-1,r=this._automationEvents[i];if(void 0!==r&&x(r)&&(void 0===s||!h(s)||s.insertTime>t))return c(t,m(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(void 0!==r&&p(r)&&(void 0===s||!h(s)))return r.value;if(void 0!==r&&d(r)&&(void 0===s||!h(s)||r.startTime+r.duration>t))return t<r.startTime+r.duration?b(t,r):r.values[r.values.length-1];if(void 0!==r&&h(r)&&(void 0===s||!h(s)))return r.value;if(void 0!==s&&u(s)){var o=f(this._automationEvents,i,r,s,this._defaultValue),a=e(o,2),g=a[0],_=a[1];return y(t,g,_,s)}if(void 0!==s&&l(s)){var T=f(this._automationEvents,i,r,s,this._defaultValue),k=e(T,2),C=k[0],A=k[1];return w(t,C,A,s)}return this._defaultValue}}])}();t.AutomationEventList=T,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},t.createSetValueAutomationEvent=o,t.createSetValueCurveAutomationEvent=a}(e,n(715),n(383),n(579))},965:(t,e,n)=>{e.parseMidi=n(786),e.writeMidi=n(498)},786:t=>{function e(t){for(var e,s=new n(t),i=[];!s.eof();){var r=o();i.push(r)}return i;function o(){var t={};t.deltaTime=s.readVarInt();var n=s.readUInt8();if(240&~n){var i;if(128&n)i=s.readUInt8(),e=n;else{if(null===e)throw"Running status byte encountered before status byte";i=n,n=e,t.running=!0}var r=n>>4;switch(t.channel=15&n,r){case 8:return t.type="noteOff",t.noteNumber=i,t.velocity=s.readUInt8(),t;case 9:var o=s.readUInt8();return t.type=0===o?"noteOff":"noteOn",t.noteNumber=i,t.velocity=o,0===o&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=i,t.amount=s.readUInt8(),t;case 11:return t.type="controller",t.controllerType=i,t.value=s.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=i,t;case 13:return t.type="channelAftertouch",t.amount=i,t;case 14:return t.type="pitchBend",t.value=i+(s.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+r}}else{if(255!==n){if(240==n)return t.type="sysEx",c=s.readVarInt(),t.data=s.readBytes(c),t;if(247==n)return t.type="endSysEx",c=s.readVarInt(),t.data=s.readBytes(c),t;throw"Unrecognised MIDI event type byte: "+n}t.meta=!0;var a=s.readUInt8(),c=s.readVarInt();switch(a){case 0:if(t.type="sequenceNumber",2!==c)throw"Expected length for sequenceNumber event is 2, got "+c;return t.number=s.readUInt16(),t;case 1:return t.type="text",t.text=s.readString(c),t;case 2:return t.type="copyrightNotice",t.text=s.readString(c),t;case 3:return t.type="trackName",t.text=s.readString(c),t;case 4:return t.type="instrumentName",t.text=s.readString(c),t;case 5:return t.type="lyrics",t.text=s.readString(c),t;case 6:return t.type="marker",t.text=s.readString(c),t;case 7:return t.type="cuePoint",t.text=s.readString(c),t;case 32:if(t.type="channelPrefix",1!=c)throw"Expected length for channelPrefix event is 1, got "+c;return t.channel=s.readUInt8(),t;case 33:if(t.type="portPrefix",1!=c)throw"Expected length for portPrefix event is 1, got "+c;return t.port=s.readUInt8(),t;case 47:if(t.type="endOfTrack",0!=c)throw"Expected length for endOfTrack event is 0, got "+c;return t;case 81:if(t.type="setTempo",3!=c)throw"Expected length for setTempo event is 3, got "+c;return t.microsecondsPerBeat=s.readUInt24(),t;case 84:if(t.type="smpteOffset",5!=c)throw"Expected length for smpteOffset event is 5, got "+c;var u=s.readUInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&u],t.hour=31&u,t.min=s.readUInt8(),t.sec=s.readUInt8(),t.frame=s.readUInt8(),t.subFrame=s.readUInt8(),t;case 88:if(t.type="timeSignature",2!=c&&4!=c)throw"Expected length for timeSignature event is 4 or 2, got "+c;return t.numerator=s.readUInt8(),t.denominator=1<<s.readUInt8(),4===c?(t.metronome=s.readUInt8(),t.thirtyseconds=s.readUInt8()):(t.metronome=36,t.thirtyseconds=8),t;case 89:if(t.type="keySignature",2!=c)throw"Expected length for keySignature event is 2, got "+c;return t.key=s.readInt8(),t.scale=s.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=s.readBytes(c),t;default:return t.type="unknownMeta",t.data=s.readBytes(c),t.metatypeByte=a,t}}}}function n(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}n.prototype.eof=function(){return this.pos>=this.bufferLen},n.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},n.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},n.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},n.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},n.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},n.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},n.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(!(128&e))return t+e;t+=127&e,t<<=7}return t},n.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32();return{id:t,length:e,data:this.readBytes(e)}},t.exports=function(t){var s=new n(t),i=s.readChunk();if("MThd"!=i.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+i.id+"'";for(var r=function(t){var e=new n(t),s={format:e.readUInt16(),numTracks:e.readUInt16()},i=e.readUInt16();return 32768&i?(s.framesPerSecond=256-(i>>8),s.ticksPerFrame=255&i):s.ticksPerBeat=i,s}(i.data),o=[],a=0;!s.eof()&&a<r.numTracks;a++){var c=s.readChunk();if("MTrk"!=c.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=e(c.data);o.push(u)}return{header:r,tracks:o}}},498:t=>{function e(t,e,i){var r,o=new s,a=e.length,c=null;for(r=0;r<a;r++)!1!==i.running&&(i.running||e[r].running)||(c=null),c=n(o,e[r],c,i.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function n(t,e,n,s){var i=e.type,r=e.deltaTime,o=e.text||"",a=e.data||[],c=null;switch(t.writeVarInt(r),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var u=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(u),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var l=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(l),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":(c=(!1!==s&&e.byte9||s&&0==e.velocity?144:128)|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(c=144|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(c=160|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(c=176|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(c=192|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(c=208|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.amount);break;case"pitchBend":(c=224|e.channel)!==n&&t.writeUInt8(c);var h=8192+e.value,p=127&h,d=h>>7&127;t.writeUInt8(p),t.writeUInt8(d);break;default:throw"Unrecognized event type: "+i}return c}function s(){this.buffer=[]}s.prototype.writeUInt8=function(t){this.buffer.push(255&t)},s.prototype.writeInt8=s.prototype.writeUInt8,s.prototype.writeUInt16=function(t){var e=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(n)},s.prototype.writeInt16=s.prototype.writeUInt16,s.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,s=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(s)},s.prototype.writeInt24=s.prototype.writeUInt24,s.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,s=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(s),this.writeUInt8(i)},s.prototype.writeInt32=s.prototype.writeUInt32,s.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},s.prototype.writeString=function(t){var e,n=t.length,s=[];for(e=0;e<n;e++)s.push(t.codePointAt(e));this.writeBytes(s)},s.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(127&e),e>>=7;e;){var s=127&e|128;n.push(s),e>>=7}this.writeBytes(n.reverse())}},s.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(t,n){if("object"!=typeof t)throw"Invalid MIDI data";n=n||{};var i,r=t.header||{},o=t.tracks||[],a=o.length,c=new s;for(function(t,e,n){var i=null==e.format?1:e.format,r=128;e.timeDivision?r=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?r=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(r=32767&e.ticksPerBeat);var o=new s;o.writeUInt16(i),o.writeUInt16(n),o.writeUInt16(r),t.writeChunk("MThd",o.buffer)}(c,r,a),i=0;i<a;i++)e(c,o[i],n);return c.buffer}},79:t=>{t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s},t.exports.__esModule=!0,t.exports.default=t.exports},987:t=>{t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},383:t=>{t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},579:(t,e,n)=>{var s=n(736);function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},156:t=>{t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,i,r,o,a=[],c=!0,u=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=r.call(n)).done)&&(a.push(s.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports},752:t=>{t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},715:(t,e,n)=>{var s=n(987),i=n(156),r=n(122),o=n(752);t.exports=function(t,e){return s(t)||i(t,e)||r(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},45:(t,e,n)=>{var s=n(738).default;t.exports=function(t,e){if("object"!=s(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},736:(t,e,n)=>{var s=n(738).default,i=n(45);t.exports=function(t){var e=i(t,"string");return"symbol"==s(e)?e:e+""},t.exports.__esModule=!0,t.exports.default=t.exports},738:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},122:(t,e,n)=>{var s=n(79);t.exports=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,n),r.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{"use strict";n.d(s,{yW:()=>qo,OY:()=>eo});class t{static getCraftGElement(t){const e=document.createElementNS("http://www.w3.org/2000/svg","g"),n=[],s=document.createElementNS("http://www.w3.org/2000/svg","path"),i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(t){case"rokket":const t=document.createElementNS("http://www.w3.org/2000/svg","path"),r=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M 0 -8, \n                                            L  -4 8,\n                                            L -2 4,\n                                            L 0 8,\n                                            L 2 6, \n                                            L 4 8,\n                                            z"),t.setAttribute("fill","none"),t.setAttribute("stroke",`${qo}`),t.setAttribute("stroke-width","1px"),t.setAttribute("vector-effect","non-scaling-stroke"),r.setAttribute("d","M -.2 -5,\n                                            L .2 -5,\n                                            L 2 2,\n                                            L -1.5 2,\n                                            z"),r.setAttribute("fill","none"),r.setAttribute("stroke",`${qo}`),r.setAttribute("stroke-width",".5px"),r.setAttribute("vector-effect","non-scaling-stroke"),e.appendChild(t),e.appendChild(r),e;case"rainbowRocket":e.setAttribute("fill","grey"),e.setAttribute("stroke-width",".5"),e.setAttribute("stroke",`${qo}`);const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M-2 -3 q-1.5 1, -2 3 q1 -0.5, 2 -1z");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","M 2 -3 q 1.5 1, 2 3 q-1 -0.5, -2 -1z");const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx","0"),c.setAttribute("cy","-9"),c.setAttribute("r",".2");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M -2 2 Q -3 5, -2 8 Q -1 7, -1 6 Q -1 7.5, 0 9 Q 1 7.5, 1 6 Q 1 7, 2 8 Q 3 5, 2 2 Q 0 1.5, -2 2");const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M -1 -5 q .75 -.75, 1 -1 q .75 .75, 1 1 q -1 -.25, -2 0");const h=document.createElementNS("http://www.w3.org/2000/svg","path");return h.setAttribute("d","M-1 -3 q -.5 2, 0 4 q .5 .15, 1 0 q -.5 -2, 0 -4 q -.5 -.15, -1 0"),e.appendChild(o),e.appendChild(a),e.appendChild(c),e.appendChild(u),e.appendChild(l),e.appendChild(h),e;case"blizzer.png":e.setAttribute("fill","none"),e.setAttribute("stroke-width",".5"),e.setAttribute("stroke",`${qo}`),s.setAttribute("d","M 0,-20, \n                                        L -4, -12 \n                                        L -8 -8\n                                        L -8 -15"),n.push(s),i.setAttribute("d","M 0,-20, \n                                        L 4, -12 \n                                        L 8 -8\n                                        L 8 -15"),n.push(i);const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d","M -4,-10, \n                                        L -4, 0 \n                                        L -8 2\n                                        L 8 2\n                                        L 4 0\n                                        L 4 -10"),n.push(p);break;case"bromber":e.setAttribute("fill","none"),e.setAttribute("stroke-width",".5"),e.setAttribute("stroke",`${qo}`);const d=document.createElementNS("http://www.w3.org/2000/svg","rect");d.setAttribute("x","-18"),d.setAttribute("y","-25"),d.setAttribute("rx","10"),d.setAttribute("ry","5"),d.setAttribute("width","34"),d.setAttribute("height","52"),n.push(d);case"helgram.png":e.setAttribute("transform","translate(-50,220) scale(0.0393700787401575,0.0100000)"),e.setAttribute("fill",`${qo}`),e.setAttribute("stroke","none"),s.setAttribute("d","M1790 2633 c-11 -26 -23 -58 -27 -72 -3 -14 -12 -34 -20 -43 -13 -15\n                    -14 -40 -3 -189 6 -95 15 -179 19 -187 11 -19 1 -62 -15 -69 -7 -2 -10 -12 -7\n                    -21 4 -13 3 -14 -5 -3 -8 11 -13 11 -33 -2 -13 -8 -39 -18 -58 -22 -19 -4 -43\n                    -16 -54 -26 -20 -18 -21 -18 -37 1 -18 20 -46 28 -35 10 3 -5 -3 -10 -14 -10\n                    -12 0 -21 5 -21 10 0 6 -14 10 -31 10 -16 0 -28 -4 -25 -9 3 -5 -2 -12 -11\n                    -16 -10 -3 -19 -1 -21 4 -2 6 -20 11 -41 11 -57 0 -69 29 -66 165 2 61 -1 155\n                    -5 210 -4 55 -3 113 1 129 5 17 4 36 -2 47 -6 13 -6 25 1 39 12 23 -4 64 -23\n                    57 -16 -5 -36 -63 -36 -104 -1 -35 14 -45 22 -15 3 9 5 -1 6 -23 0 -36 -1 -38\n                    -14 -21 -13 17 -14 15 -21 -18 -3 -20 -4 -69 0 -109 3 -39 8 -119 11 -177 3\n                    -58 8 -117 11 -132 5 -25 4 -26 -53 -30 -37 -3 -68 1 -87 10 -16 8 -59 14\n                    -100 14 -58 0 -75 4 -94 22 -19 17 -36 21 -99 21 l-75 0 -3 131 c-1 73 -6 138\n                    -11 145 -14 24 -20 164 -10 239 5 41 5 43 -9 26 -8 -11 -15 -28 -15 -38 0 -21\n                    -12 -23 -40 -6 -31 20 -33 4 -5 -48 23 -44 24 -52 15 -103 -13 -70 -13 -128 0\n                    -136 16 -10 12 -61 -6 -76 -14 -11 -15 -27 -9 -104 4 -49 8 -105 9 -123 2 -34\n                    -8 -50 -19 -32 -4 6 -17 4 -36 -6 -45 -23 -177 -152 -206 -201 -26 -45 -106\n                    -121 -152 -144 -14 -7 -38 -21 -52 -31 -23 -15 -28 -16 -33 -3 -3 8 -1 15 4\n                    15 15 0 46 35 52 58 9 31 -10 38 -21 9 -12 -31 -31 -43 -41 -27 -7 12 -4 126\n                    5 182 3 17 -1 28 -11 32 -22 8 -24 8 -24 -9 0 -8 -4 -15 -10 -15 -5 0 -10 17\n                    -10 38 0 24 3 32 9 23 5 -8 11 -9 15 -3 3 6 2 13 -3 16 -5 3 -12 22 -15 41 -6\n                    28 -12 35 -30 35 -21 0 -24 -6 -34 -82 -18 -124 -13 -216 9 -202 5 3 9 1 9 -5\n                    0 -5 -5 -11 -11 -13 -9 -3 -9 -26 0 -88 16 -113 -1 -442 -29 -565 -13 -55 -13\n                    -225 0 -225 6 0 10 -11 10 -25 0 -14 4 -25 8 -25 4 0 6 -28 4 -62 -2 -35 3\n                    -117 12 -183 8 -66 16 -198 17 -293 1 -152 3 -173 17 -170 20 4 35 71 26 118\n                    -9 51 -14 182 -6 194 3 6 5 66 3 132 -2 107 -1 123 15 132 14 8 16 18 11 56\n                    -4 25 -3 46 2 46 17 0 305 -280 492 -478 21 -21 35 -29 43 -23 6 4 20 5 31 1\n                    18 -7 19 -8 3 -15 -10 -4 -18 -13 -18 -20 0 -27 21 -26 54 2 32 29 36 30 143\n                    31 105 1 111 0 116 -20 5 -18 10 -20 39 -12 57 14 209 13 310 -3 86 -14 100\n                    -14 135 -1 21 9 66 19 100 23 54 6 64 5 70 -10 3 -10 1 -26 -5 -36 -7 -10 -12\n                    -21 -12 -24 0 -13 27 -3 50 18 65 60 142 57 82 -3 -40 -39 -102 -115 -102\n                    -124 0 -20 38 0 86 45 30 29 54 49 54 46 0 -3 15 7 32 24 33 29 41 32 115 31\n                    29 -1 45 4 51 15 13 23 3 53 -19 53 -38 0 -27 22 56 107 47 48 116 129 153\n                    180 37 51 73 95 80 98 7 2 18 -7 24 -23 11 -25 12 -23 18 36 9 77 18 89 57 70\n                    34 -16 41 -53 42 -221 1 -74 5 -115 15 -130 8 -12 17 -51 21 -87 4 -36 13 -78\n                    20 -95 7 -16 17 -43 24 -59 10 -24 14 -26 27 -15 17 14 16 81 -6 224 -5 39\n                    -12 108 -15 154 -3 52 -10 88 -17 93 -10 6 -9 11 5 19 9 5 17 20 17 31 0 17\n                    -3 19 -12 10 -19 -19 -28 -14 -28 12 0 23 3 24 41 21 l42 -4 -6 77 c-3 42 -10\n                    91 -16 107 -57 183 -97 580 -71 711 7 32 15 86 17 119 3 33 9 65 13 70 10 13\n                    35 184 28 191 -4 3 -2 19 2 35 10 33 0 43 -31 34 -13 -5 -17 -10 -11 -18 26\n                    -33 18 -167 -10 -167 -7 0 -7 4 0 13 13 15 10 75 -5 101 -9 17 -10 17 -17 1\n                    -5 -13 -9 -15 -19 -6 -11 8 -16 3 -25 -26 -6 -20 -10 -39 -8 -41 2 -2 7 6 11\n                    17 3 12 10 21 15 21 13 0 18 -36 8 -54 -8 -14 -12 -15 -25 -4 -15 12 -16 7\n                    -11 -49 5 -47 2 -65 -8 -74 -8 -7 -14 -31 -14 -60 0 -56 -14 -64 -28 -16 -13\n                    45 -31 135 -35 177 -2 19 -4 1 -5 -40 -1 -45 6 -103 17 -145 18 -70 18 -135\n                    -1 -135 -6 0 -8 -14 -5 -35 3 -19 2 -37 -2 -39 -13 -9 -90 75 -123 133 -17 31\n                    -49 74 -69 96 -43 46 -111 132 -198 254 l-61 84 5 76 c8 117 6 141 -11 178 -9\n                    18 -14 36 -11 40 15 15 41 -35 58 -115 l19 -87 -5 68 c-9 104 -15 126 -50 160\n                    -18 19 -30 39 -27 50 4 17 22 24 22 8 0 -5 7 -11 15 -15 13 -4 14 3 10 47 -3\n                    29 -7 90 -9 137 -6 142 -37 180 -76 93z m62 -153 c1 -14 0 -38 -1 -55 -2 -29\n                    -3 -28 -15 12 -7 22 -13 67 -13 100 l0 58 14 -45 c8 -25 15 -56 15 -70z m-43\n                    -117 c27 -107 20 -246 -11 -215 -15 15 -24 252 -10 252 6 0 16 -17 21 -37z\n                    m11 -288 c0 -14 0 -27 0 -30 0 -3 -3 -6 -6 -7 -12 -5 -27 29 -21 46 10 25 27\n                    19 27 -9z m-969 0 c19 -8 27 -14 19 -14 -14 0 -72 28 -59 29 4 0 22 -7 40 -15z\n                    m5 -24 c8 -8 47 -17 194 -43 30 -6 81 -11 113 -12 41 -1 61 -6 67 -16 11 -19\n                    -6 -161 -24 -210 -19 -48 -31 -128 -18 -115 5 6 15 28 22 50 15 48 36 80 43\n                    68 3 -5 7 -38 8 -74 1 -35 6 -70 12 -76 6 -9 5 -13 -4 -13 -12 0 -12 -2 0 -9\n                    11 -7 10 -12 -5 -29 -16 -19 -20 -20 -45 -7 -24 13 -27 13 -23 -3 5 -23 -11\n                    -41 -76 -82 -46 -29 -133 -102 -227 -191 -11 -11 -38 -52 -59 -92 -35 -69\n                    -130 -197 -145 -197 -23 0 -27 37 -24 230 4 246 22 659 31 715 7 41 38 85 60\n                    85 6 0 17 7 24 15 14 16 60 20 76 6z m357 -38 c-7 -2 -19 -2 -25 0 -7 3 -2 5\n                    12 5 14 0 19 -2 13 -5z m583 -27 l34 -34 0 -183 c0 -144 -3 -186 -14 -198 -8\n                    -9 -19 -58 -26 -116 -11 -105 -15 -381 -5 -408 4 -8 7 -46 9 -83 1 -38 6 -77\n                    10 -86 6 -13 4 -18 -7 -18 -13 0 -69 67 -137 165 -14 20 -44 56 -67 80 -23 24\n                    -67 76 -99 115 -31 39 -62 69 -68 67 -6 -3 -19 2 -29 11 -25 22 -31 10 -7 -16\n                    11 -12 20 -24 20 -28 0 -20 -110 107 -114 132 -1 8 -7 19 -12 22 -21 15 -47\n                    80 -40 98 8 18 8 18 17 -1 5 -11 18 -33 28 -50 11 -16 30 -49 42 -73 12 -24\n                    29 -46 38 -49 9 -2 23 -8 32 -13 9 -5 -10 37 -42 93 l-58 102 -11 130 c-6 72\n                    -13 138 -16 149 -4 12 -2 16 5 12 7 -5 9 3 5 23 -5 23 -2 32 14 40 17 9 18 16\n                    11 53 -4 24 -4 46 -1 50 15 15 241 11 260 -4 16 -13 97 8 131 34 34 26 59 22\n                    97 -16z m-1136 -195 c0 -47 -5 -102 -10 -121 -6 -19 -12 -77 -15 -128 -2 -51\n                    -8 -98 -12 -105 -4 -7 -8 -109 -8 -228 0 -186 2 -216 15 -215 9 1 16 -9 18\n                    -25 2 -20 -2 -28 -18 -32 -13 -3 -18 -10 -14 -20 3 -10 -4 -22 -19 -32 -35\n                    -23 -176 -13 -282 20 -44 14 -97 25 -118 25 -23 0 -44 7 -56 19 -18 18 -19 31\n                    -16 148 5 155 13 243 26 303 8 37 7 46 -5 56 -21 15 -20 44 2 70 17 21 100 79\n                    182 126 25 15 74 57 110 94 61 63 163 164 185 183 18 15 35 -50 35 -138z\n                    m1253 52 c41 -59 119 -158 161 -203 18 -19 45 -58 61 -85 37 -65 70 -101 123\n                    -132 l43 -26 -2 -126 c-2 -69 -2 -191 -1 -271 2 -164 -5 -206 -34 -202 -47 7\n                    -274 2 -317 -6 -51 -10 -121 -2 -99 12 7 4 24 5 37 2 27 -7 45 12 24 25 -8 5\n                    -24 9 -35 9 -43 0 -47 20 -50 233 -2 138 1 206 8 215 9 10 8 16 -3 24 -11 7\n                    -11 11 -1 15 6 2 12 9 12 15 0 5 6 15 13 22 7 7 12 28 11 47 -5 126 -6 182 -5\n                    322 1 99 5 157 11 157 6 0 25 -21 43 -47z m-1866 15 c-3 -8 -6 -5 -6 6 -1 11\n                    2 17 5 13 3 -3 4 -12 1 -19z m12 -96 c1 -23 -3 -32 -11 -29 -11 3 -16 70 -8\n                    97 4 13 19 -39 19 -68z m2321 -197 c0 -8 -4 -17 -10 -20 -6 -4 -10 5 -10 20 0\n                    15 4 24 10 20 6 -3 10 -12 10 -20z m-1164 -107 c9 -14 7 -554 -2 -581 -3 -10\n                    -19 -20 -35 -24 -33 -6 -34 -29 -1 -26 18 2 22 -6 31 -65 6 -37 12 -80 14 -95\n                    3 -34 22 -32 22 2 1 40 19 35 59 -16 20 -26 56 -68 79 -93 50 -53 179 -244\n                    181 -268 2 -33 -129 -36 -321 -6 -87 13 -127 14 -265 5 -109 -8 -165 -8 -172\n                    -1 -10 10 -1 23 78 107 28 31 37 46 29 54 -12 12 -116 -100 -133 -145 -10 -28\n                    -11 -29 -72 -22 -72 7 -101 23 -123 68 -8 18 -35 54 -58 79 -66 73 -117 135\n                    -156 192 -20 28 -42 58 -49 65 -6 7 -12 20 -12 28 0 8 -6 14 -14 14 -14 0\n                    -126 133 -126 151 0 6 8 8 18 5 9 -3 31 -8 47 -12 17 -3 63 -17 104 -31 103\n                    -34 205 -35 286 -2 58 24 60 26 57 59 -2 26 4 41 31 69 61 66 107 130 137 188\n                    26 54 80 113 208 226 30 28 34 28 51 13 21 -19 31 -12 31 21 0 13 6 23 14 23\n                    8 0 16 7 20 15 7 18 32 20 42 3z m78 -108 c24 -44 61 -91 160 -207 11 -12 35\n                    -46 55 -75 40 -58 151 -168 170 -168 6 0 31 -18 55 -40 42 -39 61 -77 57 -111\n                    -2 -21 45 -34 65 -18 16 13 407 19 420 7 9 -9 -26 -43 -85 -83 -24 -16 -55\n                    -45 -70 -64 -41 -55 -102 -110 -115 -105 -7 3 -19 -2 -26 -11 -9 -11 -9 -15\n                    -1 -15 7 0 9 -5 5 -11 -4 -8 -9 -7 -15 2 -4 7 -10 11 -13 9 -2 -3 -28 -25 -56\n                    -50 -28 -25 -73 -64 -100 -88 -46 -41 -49 -43 -110 -40 -56 2 -64 5 -85 33\n                    -22 30 -80 122 -122 192 -21 35 -93 120 -185 216 l-47 50 1 71 c0 39 -1 76 -2\n                    81 -7 31 1 475 8 475 5 0 21 -23 36 -50z m1043 -95 c-2 -20 -10 -41 -17 -48\n                    -10 -10 -12 -8 -6 6 3 10 6 32 6 48 0 16 5 29 10 29 6 0 9 -15 7 -35z m-752\n                    -180 c71 -74 93 -105 75 -105 -11 0 -46 27 -64 49 -6 7 -27 31 -46 51 -37 40\n                    -39 43 -82 108 -40 59 -34 65 11 12 21 -25 69 -76 106 -115z m888 -92 c19 -70\n                    28 -153 18 -171 -6 -11 -11 -30 -11 -41 0 -12 -7 -21 -15 -21 -8 0 -15 1 -16\n                    3 -4 15 -9 223 -5 233 7 19 24 17 29 -3z m-108 -23 c11 -18 8 -126 -4 -148\n                    -21 -39 -34 -15 -26 47 5 31 7 68 6 84 -1 27 12 36 24 17z m-2211 -176 c19 -7\n                    91 -103 83 -110 -8 -9 -107 86 -107 102 0 16 2 16 24 8z m2366 -29 c14 -17 5\n                    -36 -15 -28 -16 6 -21 43 -6 43 5 0 14 -7 21 -15z m-590 -371 c0 -3 -18 -23\n                    -41 -45 -22 -21 -38 -43 -35 -48 10 -16 -10 -21 -28 -8 -16 12 -16 14 4 40 12\n                    15 28 27 35 27 8 0 19 9 25 20 10 18 40 29 40 14z m-130 -244 c0 -12 -28 -25\n                    -36 -17 -9 9 6 27 22 27 8 0 14 -5 14 -10z"),n.push(s),i.setAttribute("d","M510 910 c0 -13 30 -13 50 0 11 7 7 10 -17 10 -18 0 -33 -4 -33 -10z"),n.push(i)}const r=`./${t}`,o=document.createElementNS("http://www.w3.org/2000/svg","image");return o.href.baseVal=r,o.onload=()=>{o.getBBox().width},o.setAttribute("width","50"),o.setAttribute("height","50"),o.setAttribute("stroke",`${qo}`),o.setAttribute("transform","translate (-25,-25)"),e.appendChild(o),n&&n.forEach((t=>{e.appendChild(t)})),e}}class e{_x;_y;_length=0;_angle=0;constructor(t=0,e=0){this._x=t,this._y=e,0==t&&0==e||(this._length=Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2)),this._angle=Math.atan2(this._y,this._x))}static fromLengthAndAngle(t,n){(n>=360||n<0)&&(n=(n%360+360)%360),n=n/180*Math.PI;const s=Math.cos(n)*t,i=Math.sin(n)*t;return new e(s,i)}add(t){this._x+=t.x,this._y+=t.y}distanceTo(t){return new e(t.x-this._x,t.y-this._y).length}inverse(){this._x=-this._x,this._y=-this._y}get length(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}get angle(){return Math.atan2(this._y,this._x)/Math.PI*180}get x(){return this._x}get y(){return this._y}set x(t){this._x=t}set y(t){this._y=t}static fromJSON(t){return new e(t.x,t.y)}toJSON(){return{x:this._x,y:this._y}}}const i="15.0.4";var r=n(795);const o=new WeakSet,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,p=new WeakMap,d=new WeakMap,m=new WeakMap,f=new WeakMap,g={construct:()=>g},_=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,v=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(_);for(;null!==i;){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(_)}return[n.join(";"),s]},y=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},w=t=>{if(!(t=>{try{new new Proxy(t,g)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},b=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},x=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},T=(t,e,n,s)=>{const i=b(t,e),r=x(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},k=t=>b(p,t),C=t=>{if(o.has(t))throw new Error("The AudioNode is already stored.");o.add(t),k(t).forEach((t=>t(!0)))},A=t=>"port"in t,S=t=>{if(!o.has(t))throw new Error("The AudioNode is not stored.");o.delete(t),k(t).forEach((t=>t(!1)))},O=(t,e)=>{!A(t)&&e.every((t=>0===t.size))&&S(t)},M={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},I=(t,e)=>t.context===e,E=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},D=()=>new DOMException("","IndexSizeError"),N=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw D();throw t}})},P={numberOfChannels:1},R=-34028234663852886e22,V=-R,q=t=>o.has(t),U={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},F=t=>b(a,t),j=t=>b(u,t),B=(t,e)=>{const{activeInputs:n}=F(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||B(n,[...e,t])}))));const s=(t=>"playbackRate"in t)(t)?[t.playbackRate]:A(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const t of s){const n=j(t);void 0!==n&&n.activeInputs.forEach((([t])=>B(t,e)))}q(t)&&S(t)},L=t=>{B(t.destination,[])},W=t=>"context"in t,z=t=>W(t[0]),G=(t,e,n,s)=>{for(const e of t)if(n(e)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},$=(t,e,[n,s],i)=>{G(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},H=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):G(r,[n,s],(t=>t[0]===n),i)},X=t=>"inputs"in t,Y=(t,e,n,s)=>{if(X(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},Z=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},J=(t,e)=>{if(!k(t).delete(e))throw new Error("Missing the expected event listener.")},Q=(t,e,n)=>{const s=b(t,e),i=x(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},K=(t,e,n,s)=>{X(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},tt=t=>b(c,t),et=t=>b(l,t),nt=t=>d.has(t),st=t=>!o.has(t),it=(t,e)=>new Promise((n=>{if(null!==e)n(!0);else{const e=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(e).connect(t.destination),o.connect(s),o.disconnect(s),e.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}})),rt=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},ot=t=>"context"in t,at=t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=ot(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"==typeof s)for(const[t,n]of e){const i=n.filter((t=>t.output!==s));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,s]of e)s.forEach((e=>{ot(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})(t.disconnect)},ct=(t,e,n,s,i)=>{const[r,o]=((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=F(e),o=Z(i[s],t,n);return null===o?[T(r,t,n,s)[2],!1]:[o[2],!0]})(t,n,s,i);if(null!==r&&(J(t,r),!o||e||nt(t)||K(tt(t),tt(n),s,i)),q(n)){const{activeInputs:t}=F(n);O(n,t)}},ut=(t,e,n,s)=>{const[i,r]=((t,e,n)=>{const{activeInputs:s,passiveInputs:i}=j(e),r=Z(s,t,n);return null===r?[Q(i,t,n)[1],!1]:[r[2],!0]})(t,n,s);null!==i&&(J(t,i),!r||e||nt(t)||tt(t).disconnect(et(n),s))};class lt{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const ht={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function pt(t,e,n,s,i){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const dt=(t,e,n,s,i)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},mt=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"==typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},ft=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,c=s.channelCount*s.numberOfInputs,u=i.reduce(((t,e)=>t+e),0),l=0===u?null:n.createBuffer(u,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=F(t),p=await((t,e)=>{const n=b(f,t),s=tt(e);return b(n,s)})(n,t),d=mt(s.numberOfInputs,s.channelCount),m=mt(s.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let u=0;u<a;u+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)pt(e,d[t],n,n,u);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{pt(e,g,t,c+n,u)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===m[t][e].byteLength&&(m[t][e]=new Float32Array(128));try{const t=d.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(u/n.sampleRate,n.sampleRate,(()=>p.process(t,m,g)));if(null!==l)for(let t=0,e=0;t<s.numberOfOutputs;t+=1){for(let n=0;n<i[t];n+=1)dt(l,m[t],n,e+n,u);e+=i[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return l},gt={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},_t={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},vt={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},yt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},wt={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},bt=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((s=>{const i=()=>{n.onmessage=null,e.close(),n.close(),s()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}}))},xt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Tt=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},kt={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Ct={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},At=()=>new DOMException("","InvalidStateError"),St=()=>new DOMException("","InvalidAccessError"),Ot={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Mt=(t,e,n,s,i,r,o,a,c,u,l)=>{const h=u.length;let p=a;for(let a=0;a<h;a+=1){let h=n[0]*u[a];for(let e=1;e<i;e+=1){const s=p-e&c-1;h+=n[e]*r[s],h-=t[e]*o[s]}for(let t=i;t<s;t+=1)h+=n[t]*r[p-t&c-1];for(let n=i;n<e;n+=1)h-=t[n]*o[p-n&c-1];r[p]=u[a],o[p]=h,p=p+1&c-1,l[a]=h}return p},It={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Et=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},Dt=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},Nt=(t,e)=>{Dt(t,e,"channelCount"),Dt(t,e,"channelCountMode"),Dt(t,e,"channelInterpretation")},Pt=t=>"function"==typeof t.getFloatTimeDomainData,Rt=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},Vt=t=>{var e;t.start=(e=t.start,(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})},qt=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},Ut=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Ft=(t,e)=>{const n=t.createBiquadFilter();return Nt(n,e),Rt(n,e,"Q"),Rt(n,e,"detune"),Rt(n,e,"frequency"),Rt(n,e,"gain"),Dt(n,e,"type"),n},jt=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Nt(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw At()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw At()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw At()}})})(n),n},Bt=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),Lt=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Nt(n,e),Rt(n,e,"delayTime"),n},Wt=(t,e)=>{const n=t.createGain();return Nt(n,e),Rt(n,e,"gain"),n};function zt(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function Gt(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)i=e,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=t[r];var s,i;return n}const $t=(t,e,n,s)=>t.createScriptProcessor(e,n,s),Ht=()=>new DOMException("","NotSupportedError"),Xt={numberOfChannels:1},Yt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Zt={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Jt={disableNormalization:!1},Qt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Kt=()=>new DOMException("","UnknownError"),te={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ee=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),ne=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},se=(t,e,n,s)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},ie=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(s){if(9!==s.code)throw s;ie(t,e,n+1e-7)}},re=t=>{const e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},oe=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},ae=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},ce=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),Bt(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},ue=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},le=(t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],(t=>t[0]===n&&t[1]===s),o)})(G),he=(t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)})(G),pe=(t=>(e,n,s,i)=>t(e[i],(t=>t[0]===n&&t[1]===s)))(x),de=new WeakMap,me=(t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0})(de),fe=(ge=new Map,_e=new WeakMap,(t,e)=>{const n=_e.get(t);if(void 0!==n)return n;const s=ge.get(t);if(void 0!==s)return s;try{const n=e();return n instanceof Promise?(ge.set(t,n),n.catch((()=>!1)).then((e=>(ge.delete(t),_e.set(t,e),e)))):(_e.set(t,n),n)}catch{return _e.set(t,!1),!1}});var ge,_e;const ve="undefined"==typeof window?null:window,ye=((t,e)=>(n,s)=>{const i=n.createAnalyser();if(Nt(i,s),!(s.maxDecibels>s.minDecibels))throw e();return Dt(i,s,"fftSize"),Dt(i,s,"maxDecibels"),Dt(i,s,"minDecibels"),Dt(i,s,"smoothingTimeConstant"),t(Pt,(()=>Pt(i)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}})(i),i})(fe,D),we=(t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer})(F),be=((t,e,n)=>async(s,i,r)=>{const o=t(s);await Promise.all(o.activeInputs.map(((t,o)=>Array.from(t).map((async([t,a])=>{const c=e(t),u=await c.render(t,i),l=s.context.destination;n(t)||s===l&&n(s)||u.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(F,we,nt),xe=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!I(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=t(r,e)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(ye,tt,be),Te=(ke=h,t=>{const e=ke.get(t);if(void 0===e)throw At();return e});var ke;const Ce=(t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null)(ve),Ae=(t=>e=>null!==t&&e instanceof t)(Ce),Se=new WeakMap,Oe=(t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}})(ue),Me=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(ve),Ie=(t=>e=>null!==t&&e instanceof t)(Me),Ee=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(ve),De=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(ve),Ne=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(ve),Pe=((t,e,n,s,i,r,o,a,u,l,h,d,m,f,g,_)=>class extends l{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=h(e);d(o)&&!0!==n(it,(()=>it(o,_)))&&at(i),c.set(this,i),p.set(this,new Set),"closed"!==e.state&&s&&C(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=h(this._context),l=g(c);if(m(t)||f(t))throw r();if(W(t)){const i=tt(t);try{const e=Y(this._nativeAudioNode,i,n,a),s=st(this);(l||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&st(t)&&C(t)}catch(t){if(12===t.code)throw r();throw t}if(e(this,t,n,a,l)){const e=u([this],t);rt(e,s(l))}return t}const p=et(t);if("playbackRate"===p.name&&1024===p.maxValue)throw o();try{this._nativeAudioNode.connect(p,n),(l||st(this))&&this._nativeAudioNode.disconnect(p,n)}catch(t){if(12===t.code)throw r();throw t}if(((t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=j(e),{outputs:o}=F(t),a=k(t),c=o=>{const a=tt(t),c=et(e);if(o){const e=Q(r,t,n);$(i,t,e,!1),s||nt(t)||a.connect(c,n)}else{const e=((t,e,n)=>x(t,(t=>t[0]===e&&t[1]===n)))(i,t,n);H(r,e,!1),s||nt(t)||a.disconnect(c,n)}};return!!G(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(c),q(t)?$(i,t,[n,c],!0):H(r,[t,n,c],!0),!0)})(this,t,n,l)){const e=u([this],t);rt(e,s(l))}}disconnect(t,e,n){let s;const o=h(this._context),c=g(o);if(void 0===t)s=((t,e)=>{const n=F(t),s=[];for(const i of n.outputs)z(i)?ct(t,e,...i):ut(t,e,...i),s.push(i[0]);return n.outputs.clear(),s})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=((t,e,n)=>{const s=F(t),i=[];for(const r of s.outputs)r[1]===n&&(z(r)?ct(t,e,...r):ut(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(W(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=((t,e,n,s,i)=>{const r=F(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==s&&t[1]!==s||void 0!==i&&t[2]!==i))).map((n=>(z(n)?ct(t,e,...n):ut(t,e,...n),r.outputs.delete(n),n[0])))})(this,c,t,e,n),0===s.length)throw r()}for(const t of s){const e=u([this],t);rt(e,a)}}})((Re=a,(t,e,n)=>{const s=[];for(let t=0;t<n.numberOfInputs;t+=1)s.push(new Set);Re.set(t,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,s,i,r,o,a,c,u,l,h,p)=>{const d=new WeakMap;return(m,f,g,_,v)=>{const{activeInputs:y,passiveInputs:w}=r(f),{outputs:b}=r(m),x=a(m),k=r=>{const a=c(f),u=c(m);if(r){const e=T(w,m,g,_);t(y,m,e,!1),v||h(m)||n(u,a,g,_),p(f)&&C(f)}else{const t=s(y,m,g,_);e(w,_,t,!1),v||h(m)||i(u,a,g,_);const n=o(f);if(0===n)l(f)&&O(f,y);else{const t=d.get(f);void 0!==t&&clearTimeout(t),d.set(f,setTimeout((()=>{l(f)&&O(f,y)}),1e3*n))}}};return!!u(b,[f,g,_],(t=>t[0]===f&&t[1]===g&&t[2]===_),!0)&&(x.add(k),l(m)?t(y,m,[g,_,k],!0):e(w,_,[m,g,k],!0),!0)}})(le,he,Y,pe,K,F,me,k,tt,G,q,nt,st),fe,((t,e,n,s,i,r)=>o=>(a,c)=>{const u=t.get(a);if(void 0===u){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(z(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,c)}else t.set(a,u+c)})(d,K,F,tt,et,q),D,St,Ht,((t,e,n,s,i,r,o,a)=>(c,u)=>{const l=e.get(c);if(void 0===l)throw new Error("Missing the expected cycle count.");const h=r(c.context),p=a(h);if(l===u){if(e.delete(c),!p&&o(c)){const e=s(c),{outputs:r}=n(c);for(const n of r)if(z(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(c,l-u)})(Y,d,F,tt,et,Te,q,Ae),((t,e,n)=>function s(i,r){const o=W(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(Se,F,b),Oe,Te,Ie,Ee,De,Ae,Ne);var Re;const Ve=((t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...M,...n},c=s(o,a);super(t,!1,c,r(o)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Pe,xe,D,ye,Te,Ae),qe=new WeakSet,Ue=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(ve),Fe=(je=new Uint32Array(1),t=>(je[0]=t,je[0]));var je;const Be=((t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)s[t]=u[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<c&&t<l;t+=1)u[t+o]=s[t]}})(Fe,D),Le=(t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)})(Fe),We=((t,e,n,s,i,r,o,a)=>{let c=null;return class u{constructor(u){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:l,numberOfChannels:h,sampleRate:p}={...P,...u};null===c&&(c=new i(1,1,44100));const d=null!==s&&e(r,r)?new s({length:l,numberOfChannels:h,sampleRate:p}):c.createBuffer(h,l,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),N(d)):e(E,(()=>E(d)))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===u.prototype||t.has(e)}}})(qe,fe,Ht,Ue,Ce,(t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0})(Ue),Be,Le),ze=(t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)})(Wt),Ge=((t,e,n)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map((async([e,s])=>{const o=t(e),a=await o.render(e,i);n(e)||a.connect(r,s)})))})(we,j,nt),$e=(t=>(e,n,s)=>t(n,e,s))(Ge),He=((t,e,n,s,i,r,o,a,c,u,l)=>(c,h)=>{const p=c.createBufferSource();return Nt(p,h),Rt(p,h,"playbackRate"),Dt(p,h,"buffer"),Dt(p,h,"loop"),Dt(p,h,"loopEnd"),Dt(p,h,"loopStart"),e(n,(()=>n(c)))||(t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw At();e.call(t,s,i,r),n=!0}})(t.start)})(p),e(s,(()=>s(c)))||(t=>{t.start=(e=t.start,(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)});var e})(p),e(i,(()=>i(c)))||u(p,c),e(r,(()=>r(c)))||Vt(p),e(o,(()=>o(c)))||l(p,c),e(a,(()=>a(c)))||qt(p),t(c,p),p})(ze,fe,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),re,oe,ae,0,(t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",(t=>()=>{const n=t.call(e);return n===s?null:n}),(t=>n=>t.call(e,null===n?s:n)))})(se),ce),Xe=((t,e)=>(n,s,i)=>(t(s).replay(i),e(s,n,i)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(j),Ge),Ye=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u){const l=r.get(u);return void 0!==l?Promise.resolve(l):(async(c,u)=>{let l=n(c);const h=I(l,u);if(!h){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(u,t),null!==o&&l.start(...o),null!==a&&l.stop(a)}return r.set(u,l),h?await t(u,c.playbackRate,l.playbackRate):await s(u,c.playbackRate,l.playbackRate),await i(c,u,l),l})(c,u)}}})($e,He,tt,Xe,be),Ze=((t,e,n,s,i,o,a,c,u,l,h,p,d)=>(s,m,f,g=null,_=null)=>{const v=f.value,y=new r.AutomationEventList(v),w=m?(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}}))(y):null,b={get defaultValue(){return v},get maxValue(){return null===g?f.maxValue:g},get minValue(){return null===_?f.minValue:_},get value(){return f.value},set value(t){f.value=t,b.setValueAtTime(t,s.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof f.cancelAndHoldAtTime)null===w&&y.flush(s.context.currentTime),y.add(i(t)),f.cancelAndHoldAtTime(t);else{const e=Array.from(y).pop();null===w&&y.flush(s.context.currentTime),y.add(i(t));const n=Array.from(y).pop();f.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?f.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?f.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?f.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&f.setValueCurveAtTime(n.values,n.startTime,n.duration))}return b},cancelScheduledValues:t=>(null===w&&y.flush(s.context.currentTime),y.add(o(t)),f.cancelScheduledValues(t),b),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;const n=s.context.currentTime;return null===w&&y.flush(n),0===Array.from(y).length&&(y.add(l(v,n)),f.setValueAtTime(v,n)),y.add(a(t,e)),f.exponentialRampToValueAtTime(t,e),b},linearRampToValueAtTime(t,e){const n=s.context.currentTime;return null===w&&y.flush(n),0===Array.from(y).length&&(y.add(l(v,n)),f.setValueAtTime(v,n)),y.add(c(t,e)),f.linearRampToValueAtTime(t,e),b},setTargetAtTime:(t,e,n)=>(null===w&&y.flush(s.context.currentTime),y.add(u(t,e,n)),f.setTargetAtTime(t,e,n),b),setValueAtTime:(t,e)=>(null===w&&y.flush(s.context.currentTime),y.add(l(t,e)),f.setValueAtTime(t,e),b),setValueCurveAtTime(t,e,n){const i=t instanceof Float32Array?t:new Float32Array(t);if(null!==p&&"webkitAudioContext"===p.name){const t=e+n,r=s.context.sampleRate,o=Math.ceil(e*r),a=Math.floor(t*r),c=a-o,u=new Float32Array(c);for(let t=0;t<c;t+=1){const s=(i.length-1)/n*((o+t)/r-e),a=Math.floor(s),c=Math.ceil(s);u[t]=a===c?i[a]:(1-(s-a))*i[a]+(1-(c-s))*i[c]}null===w&&y.flush(s.context.currentTime),y.add(h(u,e,n)),f.setValueCurveAtTime(u,e,n);const l=a/r;l<t&&d(b,u[u.length-1],l),d(b,i[i.length-1],t)}else null===w&&y.flush(s.context.currentTime),y.add(h(i,e,n)),f.setValueCurveAtTime(i,e,n);return b}};return n.set(b,f),e.set(b,s),t(b,w),b})((Je=u,(t,e)=>{Je.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),Se,l,0,r.createCancelAndHoldAutomationEvent,r.createCancelScheduledValuesAutomationEvent,r.createExponentialRampToValueAutomationEvent,r.createLinearRampToValueAutomationEvent,r.createSetTargetAutomationEvent,r.createSetValueAutomationEvent,r.createSetValueCurveAutomationEvent,Me,ie);var Je;const Qe=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),c={...U,...s},u=i(a,c),l=o(a),h=l?e():null;super(t,!1,u,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==c.buffer,this._nativeAudioBufferSourceNode=u,this._onended=null,this._playbackRate=n(this,l,u.playbackRate,V,R)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){C(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),q(this)&&S(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Pe,Ye,Ze,At,He,Te,Ae,ue),Ke=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,e){const n=r(t),s=o(n),c=i(n,e,s);super(t,!1,c,s?(t=>{const e=new WeakMap;return{render(n,s){const i=e.get(s);return void 0!==i?Promise.resolve(i):(async(n,s)=>{const i=s.destination;return e.set(s,i),await t(n,s,i),i})(n,s)}}})(a):null),this._isNodeOfNativeOfflineAudioContext=s,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Pe,0,D,At,((t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(t){if(e>r.maxChannelCount)throw t}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(Wt,se),Te,Ae,be),tn=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const u=I(c,a);if(!u){const t={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=e(a,t)}return r.set(a,c),u?(await t(a,o.Q,c.Q),await t(a,o.detune,c.detune),await t(a,o.frequency,c.frequency),await t(a,o.gain,c.gain)):(await s(a,o.Q,c.Q),await s(a,o.detune,c.detune),await s(a,o.frequency,c.frequency),await s(a,o.gain,c.gain)),await i(o,a,c),c})(o,a)}}})($e,Ft,tt,Xe,be),en=(t=>(e,n)=>t.set(e,n))(de),nn=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const c=r(t),u={...gt,...s},l=i(c,u),h=o(c);super(t,!1,l,h?n():null),this._Q=e(this,h,l.Q,V,R),this._detune=e(this,h,l.detune,1200*Math.log2(V),-1200*Math.log2(V)),this._frequency=e(this,h,l.frequency,t.sampleRate/2,0),this._gain=e(this,h,l.gain,40*Math.log10(V),R),this._nativeBiquadFilterNode=l,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw s();throw t}if(t.length!==e.length||e.length!==n.length)throw s()}})(Pe,Ze,tn,St,Ft,Te,Ae,en),sn=((t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,c=0)=>{const u=0===r.size;if(e(o))return i.call(n,o,a,c),t(r,[o,a,c],(t=>t[0]===o&&t[1]===a&&t[2]===c),!0),u&&s(),o;i.call(n,o,a),t(r,[o,a],(t=>t[0]===o&&t[1]===a),!0),u&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const c=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"==typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const u=0===r.size;c&&u&&i()})(n.disconnect),n})(G,Ee),rn=((t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(s,(()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)}),(()=>i.disconnect(s)))})(At,sn),on=((t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),Nt(i,s),i})(Me,rn),an=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!I(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(on,tt,be),cn=((t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={..._t,...r};super(t,!1,n(o,a),i(o)?e():null)}})(Pe,an,on,Te,Ae),un=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!I(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o})(i,r)}}})(jt,tt,be),ln=((t,e,n,s,i,r)=>class extends t{constructor(t,r){const o=s(t),a=(t=>({...t,channelCount:t.numberOfOutputs}))({...vt,...r});super(t,!1,n(o,a),i(o)?e():null)}})(Pe,un,jt,Te,Ae),hn=((t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=n(i,{...o,gain:r}),l=a.getChannelData(0);l[0]=1,l[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(i,c),s(Bt(h,u),(()=>c.connect(u)),(()=>c.disconnect(u)))})(ze,He,Wt,sn),pn=((t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return Nt(a,o),Rt(a,o,"offset"),e(s,(()=>s(r)))||Vt(a),e(i,(()=>i(r)))||qt(a),t(r,a),a})(ze,fe,hn,re,ae),dn=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u){const l=r.get(u);return void 0!==l?Promise.resolve(l):(async(c,u)=>{let l=n(c);const h=I(l,u);if(!h){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(u,t),null!==o&&l.start(o),null!==a&&l.stop(a)}return r.set(u,l),h?await t(u,c.offset,l.offset):await s(u,c.offset,l.offset),await i(c,u,l),l})(c,u)}}})($e,pn,tt,Xe,be),mn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...yt,...o},u=s(a,c),l=r(a),h=l?n():null;super(t,!1,u,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=u,this._offset=e(this,l,u.offset,V,R),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){C(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),q(this)&&S(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Pe,Ze,dn,pn,Te,Ae,ue),fn=((t,e)=>(n,s)=>{const i=n.createConvolver();if(Nt(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Dt(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i})(Ht,se),gn=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!I(o,r)){const e={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(r,e)}return s.set(r,o),X(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(fn,tt,be),_n=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c={...wt,...o},u=n(a,c);super(t,!1,u,i(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=u,null!==c.buffer&&r(this,c.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Pe,gn,fn,Te,Ae,en),vn=((t,e,n,s,i)=>r=>{const o=new WeakMap;return{render(a,c){const u=o.get(c);return void 0!==u?Promise.resolve(u):(async(a,c)=>{let u=n(a);const l=I(u,c);if(!l){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=e(c,t)}return o.set(c,u),l?await t(c,a.delayTime,u.delayTime):await s(c,a.delayTime,u.delayTime),await i(a,c,u),u})(a,c)}}})($e,Lt,tt,Xe,be),yn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...xt,...a},l=s(c,u),h=r(c);super(t,!1,l,h?n(u.maxDelayTime):null),this._delayTime=e(this,h,l.delayTime),o(this,u.maxDelayTime)}get delayTime(){return this._delayTime}})(Pe,Ze,vn,Lt,Te,Ae,en),wn=(t=>(e,n)=>{const s=e.createDynamicsCompressor();if(Nt(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return Rt(s,n,"attack"),Rt(s,n,"knee"),Rt(s,n,"ratio"),Rt(s,n,"release"),Rt(s,n,"threshold"),s})(Ht),bn=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const u=I(c,a);if(!u){const t={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=e(a,t)}return r.set(a,c),u?(await t(a,o.attack,c.attack),await t(a,o.knee,c.knee),await t(a,o.ratio,c.ratio),await t(a,o.release,c.release),await t(a,o.threshold,c.threshold)):(await s(a,o.attack,c.attack),await s(a,o.knee,c.knee),await s(a,o.ratio,c.ratio),await s(a,o.release,c.release),await s(a,o.threshold,c.threshold)),await i(o,a,c),c})(o,a)}}})($e,wn,tt,Xe,be),xn=((t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const c=r(t),u={...kt,...i},l=s(c,u),h=o(c);super(t,!1,l,h?n():null),this._attack=e(this,h,l.attack),this._knee=e(this,h,l.knee),this._nativeDynamicsCompressorNode=l,this._ratio=e(this,h,l.ratio),this._release=e(this,h,l.release),this._threshold=e(this,h,l.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Pe,Ze,bn,wn,Ht,Te,Ae,en),Tn=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const u=I(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.gain,c.gain):await s(a,o.gain,c.gain),await i(o,a,c),c})(o,a)}}})($e,Wt,tt,Xe,be),kn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Ct,...o},u=s(a,c),l=r(a);super(t,!1,u,l?n():null),this._gain=e(this,l,u.gain,V,R)}get gain(){return this._gain}})(Pe,Ze,Tn,Wt,Te,Ae),Cn=((t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:u,feedforward:l})=>{const h=Ut(r,i.sampleRate),p=u instanceof Float64Array?u:new Float64Array(u),d=l instanceof Float64Array?l:new Float64Array(l),m=p.length,f=d.length,g=Math.min(m,f);if(0===m||m>20)throw s();if(0===p[0])throw e();if(0===f||f>20)throw s();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<f;t+=1)d[t]/=p[0];for(let t=1;t<m;t+=1)p[t]/=p[0]}const _=n(i,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const v=[],y=[],w=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),y.push(t),w.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let t=0;t<s;t+=1){const s=e.getChannelData(t),i=n.getChannelData(t);v[t]=Mt(p,m,d,f,g,y[t],w[t],v[t],32,s,i)}};const b=i.sampleRate/2;return Bt({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/b),r=[Math.cos(i),Math.sin(i)],o=zt(Gt(d,r),Gt(p,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),s[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(St,At,$t,Ht),An=((t,e,n,s)=>i=>t(Et,(()=>Et(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(fe,Wt,$t,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(Wt,Ce)),Sn=((t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let c=null;return{render(u,l){const h=a.get(l);return void 0!==h?Promise.resolve(h):(async(u,l)=>{let h=null,p=e(u);const d=I(p,l);if(void 0===l.createIIRFilter?h=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=l.createIIRFilter(o,r)),a.set(l,null===h?p:h),null!==h){if(null===c){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(u.context.destination.channelCount,u.context.length,l.sampleRate);c=(async()=>(await s(u,t,t.destination),((t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,c=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const u=new Float32Array(32),l=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let e=0;e<p;e+=1){const n=t.getChannelData(e),s=h.getChannelData(e);u.fill(0),l.fill(0),Mt(i,o,r,a,c,u,l,0,32,n,s)}return h})(await i(t),l,r,o)))()}const t=await c;return h.buffer=t,h.start(0),h}return await s(u,l,p),p})(u,l)}}})(He,tt,Ce,be,An),On=(t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return Nt(i,s),i})(Cn),Mn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),c=i(a),u={...Ot,...o},l=e(a,c?null:t.baseLatency,u);super(t,!1,l,c?n(u.feedback,u.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw St();return e.call(t,n,s,i)})})(l),this._nativeIIRFilterNode=l,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Pe,On,Sn,Te,Ae,en),In=((t,e,n,s,i,r,o,a)=>(c,u)=>{const l=u.listener,{forwardX:h,forwardY:p,forwardZ:d,positionX:m,positionY:f,positionZ:g,upX:_,upY:v,upZ:y}=void 0===l.forwardX?(()=>{const h=new Float32Array(1),p=e(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(u);let m=!1,f=[0,0,-1,0,1,0],g=[0,0,0];const _=()=>{if(m)return;m=!0;const t=s(u,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[r(t,h,0),r(t,h,1),r(t,h,2),r(t,h,3),r(t,h,4),r(t,h,5)];e.some(((t,e)=>t!==f[e]))&&(l.setOrientation(...e),f=e);const n=[r(t,h,6),r(t,h,7),r(t,h,8)];n.some(((t,e)=>t!==g[e]))&&(l.setPosition(...n),g=n)},p.connect(t)},v=t=>e=>{e!==f[t]&&(f[t]=e,l.setOrientation(...f))},y=t=>e=>{e!==g[t]&&(g[t]=e,l.setPosition(...g))},w=(e,s,r)=>{const o=n(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});o.connect(p,0,e),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>s});const l=t({context:c},d,o.offset,V,R);var h,m,f,g,v,y,w;return a(l,"value",(t=>()=>t.call(l)),(t=>e=>{try{t.call(l,e)}catch(t){if(9!==t.code)throw t}_(),d&&r(e)})),l.cancelAndHoldAtTime=(h=l.cancelAndHoldAtTime,d?()=>{throw i()}:(...t)=>{const e=h.apply(l,t);return _(),e}),l.cancelScheduledValues=(m=l.cancelScheduledValues,d?()=>{throw i()}:(...t)=>{const e=m.apply(l,t);return _(),e}),l.exponentialRampToValueAtTime=(f=l.exponentialRampToValueAtTime,d?()=>{throw i()}:(...t)=>{const e=f.apply(l,t);return _(),e}),l.linearRampToValueAtTime=(g=l.linearRampToValueAtTime,d?()=>{throw i()}:(...t)=>{const e=g.apply(l,t);return _(),e}),l.setTargetAtTime=(v=l.setTargetAtTime,d?()=>{throw i()}:(...t)=>{const e=v.apply(l,t);return _(),e}),l.setValueAtTime=(y=l.setValueAtTime,d?()=>{throw i()}:(...t)=>{const e=y.apply(l,t);return _(),e}),l.setValueCurveAtTime=(w=l.setValueCurveAtTime,d?()=>{throw i()}:(...t)=>{const e=w.apply(l,t);return _(),e}),l};return{forwardX:w(0,0,v(0)),forwardY:w(1,0,v(1)),forwardZ:w(2,-1,v(2)),positionX:w(6,0,y(0)),positionY:w(7,0,y(1)),positionZ:w(8,0,y(2)),upX:w(3,0,v(3)),upY:w(4,1,v(4)),upZ:w(5,0,v(5))}})():l;return{get forwardX(){return h},get forwardY(){return p},get forwardZ(){return d},get positionX(){return m},get positionY(){return f},get positionZ(){return g},get upX(){return _},get upY(){return v},get upZ(){return y}}})(Ze,on,pn,$t,Ht,ee,Ae,se),En=new WeakMap,Dn=((t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,h.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Ke,In,Oe,Ae,En,ue),Nn=((t,e,n,s,i,r)=>(o,a)=>{const c=o.createOscillator();return Nt(c,a),Rt(c,a,"detune"),Rt(c,a,"frequency"),void 0!==a.periodicWave?c.setPeriodicWave(a.periodicWave):Dt(c,a,"type"),e(n,(()=>n(o)))||Vt(c),e(s,(()=>s(o)))||r(c,o),e(i,(()=>i(o)))||qt(c),t(o,c),c})(ze,fe,re,oe,ae,ce),Pn=((t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){c=t},render(u,l){const h=r.get(l);return void 0!==h?Promise.resolve(h):(async(u,l)=>{let h=n(u);const p=I(h,l);if(!p){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===o?void 0:o,type:h.type};h=e(l,t),null!==a&&h.start(a),null!==c&&h.stop(c)}return r.set(l,h),p?(await t(l,u.detune,h.detune),await t(l,u.frequency,h.frequency)):(await s(l,u.detune,h.detune),await s(l,u.frequency,h.frequency)),await i(u,l,h),h})(u,l)}}})($e,Nn,tt,Xe,be),Rn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),c={...Yt,...o},u=n(a,c),l=r(a),h=l?s():null,p=t.sampleRate/2;super(t,!1,u,h),this._detune=e(this,l,u.detune,153600,-153600),this._frequency=e(this,l,u.frequency,p,-p),this._nativeOscillatorNode=u,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){C(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),q(this)&&S(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Pe,Ze,Nn,Pn,Te,Ae,ue),Vn=(t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}})(He),qn=((t,e,n,s,i)=>(r,{curve:o,oversample:a,...c})=>{const u=r.createWaveShaper(),l=r.createWaveShaper();Nt(u,c),Nt(l,c);const h=n(r,{...c,gain:1}),p=n(r,{...c,gain:-1}),d=n(r,{...c,gain:1}),m=n(r,{...c,gain:-1});let f=null,g=!1,_=null;const v={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){h.channelCount=t,p.channelCount=t,u.channelCount=t,d.channelCount=t,l.channelCount=t,m.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){h.channelCountMode=t,p.channelCountMode=t,u.channelCountMode=t,d.channelCountMode=t,l.channelCountMode=t,m.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,p.channelInterpretation=t,u.channelInterpretation=t,d.channelInterpretation=t,l.channelInterpretation=t,m.channelInterpretation=t},get context(){return u.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)u.curve=n,l.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,c=Math.floor(a),u=Math.ceil(a);e[o]=c===u?n[c]:(1-(a-c))*n[c]+(1-(u-a))*n[u],s[o]=c===u?-n[t-1-c]:-(1-(a-c))*n[t-1-c]-(1-(u-a))*n[t-1-u]}e[i]=t%2==1?n[i-1]:(n[i-2]+n[i-1])/2,u.curve=e,l.curve=s}_=n,g&&(s(_)&&null===f?f=t(r,h):null!==f&&(f(),f=null))},get inputs(){return[h]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(t){u.oversample=t,l.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};return null!==o&&(v.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==v.oversample&&(v.oversample=a),i(Bt(v,d),(()=>{h.connect(u).connect(d),h.connect(p).connect(l).connect(m).connect(d),g=!0,s(_)&&(f=t(r,h))}),(()=>{h.disconnect(u),u.disconnect(d),h.disconnect(p),p.disconnect(l),l.disconnect(m),m.disconnect(d),g=!1,null!==f&&(f(),f=null)}))})(Vn,At,Wt,ne,sn),Un=((t,e,n,s,i,r,o)=>(a,c)=>{const u=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,c);Nt(u,c);const l=null===c.curve||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(null!==l&&l.length<2)throw e();Dt(u,{curve:l},"curve"),Dt(u,c,"oversample");let h=null,p=!1;return o(u,"curve",(t=>()=>t.call(u)),(e=>n=>(e.call(u,n),p&&(s(n)&&null===h?h=t(a,u):s(n)||null===h||(h(),h=null)),n))),i(u,(()=>{p=!0,s(u.curve)&&(h=t(a,u))}),(()=>{p=!1,null!==h&&(h(),h=null)}))})(Vn,At,qn,ne,sn,Me,se),Fn=((t,e,n,s,i,r,o,a,c,u)=>(l,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:d,distanceModel:m,maxDistance:f,orientationX:g,orientationY:_,orientationZ:v,panningModel:y,positionX:w,positionY:b,positionZ:x,refDistance:T,rolloffFactor:k,...C})=>{const A=l.createPanner();if(C.channelCount>2)throw o();if("max"===C.channelCountMode)throw o();Nt(A,C);const S={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},O=n(l,{...S,channelInterpretation:"speakers",numberOfInputs:6}),M=s(l,{...C,gain:1}),I=s(l,{...S,gain:1}),E=s(l,{...S,gain:0}),D=s(l,{...S,gain:0}),N=s(l,{...S,gain:0}),P=s(l,{...S,gain:0}),R=s(l,{...S,gain:0}),V=i(l,256,6,1),q=r(l,{...S,curve:new Float32Array([1,1]),oversample:"none"});let U=[g,_,v],F=[w,b,x];const j=new Float32Array(1);V.onaudioprocess=({inputBuffer:t})=>{const e=[c(t,j,0),c(t,j,1),c(t,j,2)];e.some(((t,e)=>t!==U[e]))&&(A.setOrientation(...e),U=e);const n=[c(t,j,3),c(t,j,4),c(t,j,5)];n.some(((t,e)=>t!==F[e]))&&(A.setPosition(...n),F=n)},Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0});const B={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(t){if(t>2)throw o();M.channelCount=t,A.channelCount=t},get channelCountMode(){return A.channelCountMode},set channelCountMode(t){if("max"===t)throw o();M.channelCountMode=t,A.channelCountMode=t},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(t){M.channelInterpretation=t,A.channelInterpretation=t},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(t){A.coneInnerAngle=t},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(t){A.coneOuterAngle=t},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();A.coneOuterGain=t},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(t){A.distanceModel=t},get inputs(){return[M]},get maxDistance(){return A.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;A.maxDistance=t},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return I.gain},get orientationY(){return E.gain},get orientationZ(){return D.gain},get panningModel(){return A.panningModel},set panningModel(t){A.panningModel=t},get positionX(){return N.gain},get positionY(){return P.gain},get positionZ(){return R.gain},get refDistance(){return A.refDistance},set refDistance(t){if(t<0)throw new RangeError;A.refDistance=t},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;A.rolloffFactor=t},addEventListener:(...t)=>M.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>M.dispatchEvent(t[0]),removeEventListener:(...t)=>M.removeEventListener(t[0],t[1],t[2])};return h!==B.coneInnerAngle&&(B.coneInnerAngle=h),p!==B.coneOuterAngle&&(B.coneOuterAngle=p),d!==B.coneOuterGain&&(B.coneOuterGain=d),m!==B.distanceModel&&(B.distanceModel=m),f!==B.maxDistance&&(B.maxDistance=f),g!==B.orientationX.value&&(B.orientationX.value=g),_!==B.orientationY.value&&(B.orientationY.value=_),v!==B.orientationZ.value&&(B.orientationZ.value=v),y!==B.panningModel&&(B.panningModel=y),w!==B.positionX.value&&(B.positionX.value=w),b!==B.positionY.value&&(B.positionY.value=b),x!==B.positionZ.value&&(B.positionZ.value=x),T!==B.refDistance&&(B.refDistance=T),k!==B.rolloffFactor&&(B.rolloffFactor=k),1===U[0]&&0===U[1]&&0===U[2]||A.setOrientation(...U),0===F[0]&&0===F[1]&&0===F[2]||A.setPosition(...F),u(Bt(B,A),(()=>{M.connect(A),t(M,q,0,0),q.connect(I).connect(O,0,0),q.connect(E).connect(O,0,1),q.connect(D).connect(O,0,2),q.connect(N).connect(O,0,3),q.connect(P).connect(O,0,4),q.connect(R).connect(O,0,5),O.connect(V).connect(l.destination)}),(()=>{M.disconnect(A),a(M,q,0,0),q.disconnect(I),I.disconnect(O),q.disconnect(E),E.disconnect(O),q.disconnect(D),D.disconnect(O),q.disconnect(N),N.disconnect(O),q.disconnect(P),P.disconnect(O),q.disconnect(R),R.disconnect(O),O.disconnect(V),V.disconnect(l.destination)}))})(Y,At,on,Wt,$t,Un,Ht,K,ee,sn),jn=(t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(Nt(s,n),Rt(s,n,"orientationX"),Rt(s,n,"orientationY"),Rt(s,n,"orientationZ"),Rt(s,n,"positionX"),Rt(s,n,"positionY"),Rt(s,n,"positionZ"),Dt(s,n,"coneInnerAngle"),Dt(s,n,"coneOuterAngle"),Dt(s,n,"coneOuterGain"),Dt(s,n,"distanceModel"),Dt(s,n,"maxDistance"),Dt(s,n,"panningModel"),Dt(s,n,"refDistance"),Dt(s,n,"rolloffFactor"),s)})(Fn),Bn=((t,e,n,s,i,r,o,a,c,u)=>()=>{const l=new WeakMap;let h=null;return{render(p,d){const m=l.get(d);return void 0!==m?Promise.resolve(m):(async(p,d)=>{let m=null,f=r(p);const g={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation},_={...g,coneInnerAngle:f.coneInnerAngle,coneOuterAngle:f.coneOuterAngle,coneOuterGain:f.coneOuterGain,distanceModel:f.distanceModel,maxDistance:f.maxDistance,panningModel:f.panningModel,refDistance:f.refDistance,rolloffFactor:f.rolloffFactor},v=I(f,d);if("bufferSize"in f)m=s(d,{...g,gain:1});else if(!v){const t={..._,orientationX:f.orientationX.value,orientationY:f.orientationY.value,orientationZ:f.orientationZ.value,positionX:f.positionX.value,positionY:f.positionY.value,positionZ:f.positionZ.value};f=i(d,t)}if(l.set(d,null===m?f:m),null!==m){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),h=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return u(t)})()}const t=await h,r=s(d,{...g,gain:1});await c(p,d,r);const l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let f=[l[0][0],l[1][0],l[2][0]],v=[l[3][0],l[4][0],l[5][0]],y=s(d,{...g,gain:1}),w=i(d,{..._,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:v[0],positionY:v[1],positionZ:v[2]});r.connect(y).connect(w.inputs[0]),w.connect(m);for(let e=128;e<t.length;e+=128){const t=[l[0][e],l[1][e],l[2][e]],n=[l[3][e],l[4][e],l[5][e]];if(t.some(((t,e)=>t!==f[e]))||n.some(((t,e)=>t!==v[e]))){f=t,v=n;const o=e/d.sampleRate;y.gain.setValueAtTime(0,o),y=s(d,{...g,gain:0}),w=i(d,{..._,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),y.gain.setValueAtTime(1,o),r.connect(y).connect(w.inputs[0]),w.connect(m)}}return m}return v?(await t(d,p.orientationX,f.orientationX),await t(d,p.orientationY,f.orientationY),await t(d,p.orientationZ,f.orientationZ),await t(d,p.positionX,f.positionX),await t(d,p.positionY,f.positionY),await t(d,p.positionZ,f.positionZ)):(await a(d,p.orientationX,f.orientationX),await a(d,p.orientationY,f.orientationY),await a(d,p.orientationZ,f.orientationZ),await a(d,p.positionX,f.positionX),await a(d,p.positionY,f.positionY),await a(d,p.positionZ,f.positionZ)),X(f)?await c(p,d,f.inputs[0]):await c(p,d,f),f})(p,d)}}})($e,on,pn,Wt,jn,tt,Ce,Xe,be,An),Ln=((t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const c=i(t),u={...Zt,...a},l=n(c,u),h=r(c);super(t,!1,l,h?s():null),this._nativePannerNode=l,this._orientationX=e(this,h,l.orientationX,V,R),this._orientationY=e(this,h,l.orientationY,V,R),this._orientationZ=e(this,h,l.orientationZ,V,R),this._positionX=e(this,h,l.positionX,V,R),this._positionY=e(this,h,l.positionY,V,R),this._positionZ=e(this,h,l.positionZ,V,R),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Pe,Ze,jn,Bn,Te,Ae,en),Wn=(t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a})(D),zn=((t,e,n,s)=>class s{constructor(s,i){const r=e(s),o=(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})({...Jt,...i}),a=t(r,o);return n.add(a),a}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===s.prototype||n.has(t)}})(Wn,Te,new WeakSet),Gn=((t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),c=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...u,oversample:"none"},h=(t,r,h,p,d)=>{if(1===r)return((t,e,i,r)=>{const h=new Float32Array(o),p=new Float32Array(o);for(let t=0;t<o;t+=1){const e=t/16384*c;h[t]=Math.cos(e),p[t]=Math.sin(e)}const d=n(t,{...u,gain:0}),m=s(t,{...l,curve:h}),f=s(t,{...l,curve:a}),g=n(t,{...u,gain:0}),_=s(t,{...l,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===f.inputs?f:f.inputs[0]),e.connect(g),f.connect(i),i.connect(void 0===m.inputs?m:m.inputs[0]),i.connect(void 0===_.inputs?_:_.inputs[0]),m.connect(d.gain),_.connect(g.gain),d.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===f.inputs?f:f.inputs[0]),e.disconnect(g),f.disconnect(i),i.disconnect(void 0===m.inputs?m:m.inputs[0]),i.disconnect(void 0===_.inputs?_:_.inputs[0]),m.disconnect(d.gain),_.disconnect(g.gain),d.disconnect(r,0,0),g.disconnect(r,0,1)}}})(t,h,p,d);if(2===r)return((t,i,r,h)=>{const p=new Float32Array(o),d=new Float32Array(o),m=new Float32Array(o),f=new Float32Array(o),g=Math.floor(8192.5);for(let t=0;t<o;t+=1)if(t>g){const e=(t-g)/(16384-g)*c;p[t]=Math.cos(e),d[t]=Math.sin(e),m[t]=0,f[t]=1}else{const e=t/(16384-g)*c;p[t]=1,d[t]=0,m[t]=Math.cos(e),f[t]=Math.sin(e)}const _=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(t,{...u,gain:0}),y=s(t,{...l,curve:p}),w=n(t,{...u,gain:0}),b=s(t,{...l,curve:d}),x=s(t,{...l,curve:a}),T=n(t,{...u,gain:0}),k=s(t,{...l,curve:m}),C=n(t,{...u,gain:0}),A=s(t,{...l,curve:f});return{connectGraph(){i.connect(_),i.connect(void 0===x.inputs?x:x.inputs[0]),_.connect(v,0),_.connect(w,0),_.connect(T,1),_.connect(C,1),x.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===k.inputs?k:k.inputs[0]),r.connect(void 0===A.inputs?A:A.inputs[0]),y.connect(v.gain),b.connect(w.gain),k.connect(T.gain),A.connect(C.gain),v.connect(h,0,0),T.connect(h,0,0),w.connect(h,0,1),C.connect(h,0,1)},disconnectGraph(){i.disconnect(_),i.disconnect(void 0===x.inputs?x:x.inputs[0]),_.disconnect(v,0),_.disconnect(w,0),_.disconnect(T,1),_.disconnect(C,1),x.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===k.inputs?k:k.inputs[0]),r.disconnect(void 0===A.inputs?A:A.inputs[0]),y.disconnect(v.gain),b.disconnect(w.gain),k.disconnect(T.gain),A.disconnect(C.gain),v.disconnect(h,0,0),T.disconnect(h,0,0),w.disconnect(h,0,1),C.disconnect(h,0,1)}}})(t,h,p,d);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw i();const u=t(e,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),l=n(e,{...c,channelCount:s,channelCountMode:o,gain:1}),p=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:m}=h(e,s,l,p,u);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const f={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(t){l.channelCount!==t&&(g&&m(),({connectGraph:d,disconnectGraph:m}=h(e,t,l,p,u)),g&&d()),l.channelCount=t},get channelCountMode(){return l.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();l.channelCountMode=t},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t},get context(){return l.context},get inputs(){return[l]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2])};let g=!1;return r(Bt(f,u),(()=>{d(),g=!0}),(()=>{m(),g=!1}))}})(on,jt,Wt,Un,Ht,sn),$n=((t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return Nt(r,s),Rt(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r})(Gn,Ht),Hn=((t,e,n,s,i)=>()=>{const r=new WeakMap;return{render(o,a){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(o,a)=>{let c=n(o);const u=I(c,a);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=e(a,t)}return r.set(a,c),u?await t(a,o.pan,c.pan):await s(a,o.pan,c.pan),X(c)?await i(o,a,c.inputs[0]):await i(o,a,c),c})(o,a)}}})($e,$n,tt,Xe,be),Xn=((t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),c={...Qt,...o},u=n(a,c),l=r(a);super(t,!1,u,l?s():null),this._pan=e(this,l,u.pan)}get pan(){return this._pan}})(Pe,Ze,$n,Hn,Te,Ae),Yn=((t,e,n)=>()=>{const s=new WeakMap;return{render(i,r){const o=s.get(r);return void 0!==o?Promise.resolve(o):(async(i,r)=>{let o=e(i);if(!I(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(r,e)}return s.set(r,o),X(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o})(i,r)}}})(Un,tt,be),Zn=((t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),c={...te,...e},u=n(a,c);super(t,!0,u,r(a)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=u,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Pe,At,Un,Yn,Te,Ae,en),Jn=(t=>null!==t&&t.isSecureContext)(ve),Qn=(t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(ve),Kn=new WeakMap,ts=((t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),t.set(n,s),s})(Kn,Ce),es=Jn?((t,e,n,s,i,r,o,a,c,u,l,h,p)=>{let d=0;return(f,g,_={credentials:"omit"})=>{const b=l.get(f);if(void 0!==b&&b.has(g))return Promise.resolve();const x=u.get(f);if(void 0!==x){const t=x.get(g);if(void 0!==t)return t}const T=r(f),k=void 0===T.audioWorklet?i(g).then((([t,e])=>{const[s,i]=v(t,e);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;s(T.currentTime,T.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=m.get(T);if(void 0!==s){if(s.has(t))throw e();w(n),y(n.parameterDescriptors),s.set(t,n)}else w(n),y(n.parameterDescriptors),m.set(T,new Map([[t,n]]))}),T.sampleRate,void 0,void 0)))})):Promise.all([i(g),Promise.resolve(t(h,h))]).then((([[t,e],n])=>{const s=d+1;d=s;const[i,r]=v(t,e),u=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${s}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),l=URL.createObjectURL(u);return T.audioWorklet.addModule(l,_).then((()=>{if(a(T))return T;const t=o(T);return t.audioWorklet.addModule(l,_).then((()=>t))})).then((t=>{if(null===c)throw new SyntaxError;try{new c(t,`__sac${s}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(l)))}));return void 0===x?u.set(f,new Map([[g,k]])):x.set(g,k),k.then((()=>{const t=l.get(f);void 0===t?l.set(f,new Set([g])):t.add(g)})).finally((()=>{const t=u.get(f);void 0!==t&&t.delete(g)})),k}})(fe,Ht,(t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(u(),s(o),!1):null!==c?c(e,n,i,r,o):void 0,r.onerror=()=>{u(),s(new SyntaxError)},r.onload=()=>{u(),n()},r.src=a,r.type="module",i.appendChild(r)}})))(ve),Qn,(async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw new DOMException("","AbortError")}),Te,ts,Ae,Ne,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await s.startRendering(),await new Promise((t=>setTimeout(t)))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o})(Ne,Ce),ve):void 0,ns=((t,e)=>n=>t(n)||e(n))(Ie,Ae),ss=((t,e,n,s,i,r,o,a,c,u,l)=>(n,s)=>{const h=o(n)?n:r(n);if(i.has(s)){const t=new DOMException("","DataCloneError");return Promise.reject(t)}try{i.add(s)}catch{}return e(c,(()=>c(h)))?h.decodeAudioData(s).then((n=>(bt(s).catch((()=>{})),e(a,(()=>a(n)))||l(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await bt(s)}catch{}},r=t=>{n(t),i()};try{h.decodeAudioData(s,(n=>{"function"!=typeof n.copyFromChannel&&(u(n),N(n)),t.add(n),i().then((()=>e(n)))}),(t=>{r(null===t?new DOMException("","EncodingError"):t)}))}catch(t){r(t)}}))})(qe,fe,0,0,new WeakSet,Te,ns,E,Et,Be,Le),is=((t,e,n,s,i,r,o,a,c,u,l,h,p,d,m,f,g,_,v,y)=>class extends m{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(t=1){return new l(this,{maxDelayTime:t})}createDynamicsCompressor(){return new h(this)}createGain(){return new p(this)}createIIRFilter(t,e){return new d(this,{feedback:e,feedforward:t})}createOscillator(){return new f(this)}createPanner(){return new g(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new _(this,{...n,imag:e,real:t})}createStereoPanner(){return new v(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return u(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}})(es,Ve,We,Qe,nn,cn,ln,mn,_n,ss,yn,xn,kn,Mn,Dn,Rn,Ln,zn,Xn,Zn),rs=((t,e,n,s)=>class extends t{constructor(t,e){const i=n(t),r=((t,e)=>t.createMediaElementSource(e.mediaElement))(i,e);if(s(i))throw TypeError();super(t,!0,r,null),this._nativeMediaElementAudioSourceNode=r}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Pe,0,Te,Ae),os=((t,e,n,s)=>class extends t{constructor(t,e){const i=n(t);if(s(i))throw new TypeError;const r=((t,e)=>{const n=t.createMediaStreamDestination();return Nt(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n})(i,{...It,...e});super(t,!1,r,null),this._nativeMediaStreamAudioDestinationNode=r}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Pe,0,Te,Ae),as=((t,e,n,s)=>class extends t{constructor(t,e){const i=n(t),r=((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i})(i,e);if(s(i))throw new TypeError;super(t,!0,r,null),this._nativeMediaStreamAudioSourceNode=r}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Pe,0,Te,Ae),cs=((t,e)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r})(At,Ae),us=((t,e,n)=>class extends t{constructor(t,s){const i=n(t);super(t,!0,e(i,s),null)}})(Pe,cs,Te),ls=((t,e,n,s,i,r,o,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new c(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw n();throw t}if(null===e)throw s();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===c.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),L(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(is,At,Ht,Kt,rs,os,as,us,Me),hs=(t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n})(En),ps=(t=>(e,n)=>{t(e).add(n)})(hs),ds=(t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return ot(n)?r.connect(n,0,i):r.connect(n,0)})(D),ms=(t=>(e,n)=>{t(e).delete(n)})(hs),fs=(t=>(e,n=void 0,s=void 0,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?Tt(t,e,n).disconnect():ot(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?Tt(t,e,s).disconnect(n,0):Tt(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):Tt(t,e,s).disconnect(n,0))(D),gs=new WeakMap,_s=((t,e)=>n=>e(t,n))(gs,b),vs=((t,e,n,s,i,r,o,a,c,u,l,h,p)=>(d,m,g,_)=>{if(0===_.numberOfInputs&&0===_.numberOfOutputs)throw c();const v=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(v.some((t=>t<1)))throw c();if(v.length!==_.numberOfOutputs)throw e();if("explicit"!==_.channelCountMode)throw c();const y=_.channelCount*_.numberOfInputs,w=v.reduce(((t,e)=>t+e),0),b=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length;if(y+b>6||w>6)throw c();const x=new MessageChannel,T=[],k=[];for(let t=0;t<_.numberOfInputs;t+=1)T.push(o(d,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),k.push(i(d,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const C=[];if(void 0!==g.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of g.parameterDescriptors){const i=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==_.parameterData[s]?_.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?V:e},minValue:{get:()=>void 0===n?R:n}}),C.push(i)}const A=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+b)}),S=Ut(m,d.sampleRate),O=a(d,S,y+b,Math.max(1,w)),M=i(d,{channelCount:Math.max(1,w),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,w)}),I=[];for(let t=0;t<_.numberOfOutputs;t+=1)I.push(s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[t]}));for(let t=0;t<_.numberOfInputs;t+=1){T[t].connect(k[t]);for(let e=0;e<_.channelCount;e+=1)k[t].connect(A,e,t*_.channelCount+e)}const E=new lt(void 0===g.parameterDescriptors?[]:g.parameterDescriptors.map((({name:t},e)=>{const n=C[e];return n.connect(A,0,y+e),n.start(0),[t,n.offset]})));A.connect(O);let D=_.channelInterpretation,N=null;const P=0===_.numberOfOutputs?[O]:I,q={get bufferSize(){return S},get channelCount(){return _.channelCount},set channelCount(t){throw n()},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of T)e.channelInterpretation=t;D=t},get context(){return O.context},get inputs(){return T},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(t){"function"==typeof N&&q.removeEventListener("processorerror",N),N="function"==typeof t?t:null,"function"==typeof N&&q.addEventListener("processorerror",N)},get parameters(){return E},get port(){return x.port2},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,P),disconnect:u.bind(null,P),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])},U=new Map;var F,j;x.port1.addEventListener=(F=x.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=U.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{l(d.currentTime,d.sampleRate,(()=>e(t)))},U.set(e,t[1]))}}return F.call(x.port1,t[0],t[1],t[2])}),x.port1.removeEventListener=(j=x.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=U.get(t[1]);void 0!==e&&(U.delete(t[1]),t[1]=e)}return j.call(x.port1,t[0],t[1],t[2])});let B=null;Object.defineProperty(x.port1,"onmessage",{get:()=>B,set:t=>{"function"==typeof B&&x.port1.removeEventListener("message",B),B="function"==typeof t?t:null,"function"==typeof B&&(x.port1.addEventListener("message",B),x.port1.start())}}),g.prototype.port=x.port1;let L=null;const W=((t,e,n,s)=>{let i=f.get(t);void 0===i&&(i=new WeakMap,f.set(t,i));const r=(async(t,e)=>{const n=await(t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})))(e);return new t(n)})(n,s);return i.set(e,r),r})(d,q,g,_);W.then((t=>L=t));const z=mt(_.numberOfInputs,_.channelCount),G=mt(_.numberOfOutputs,v),$=void 0===g.parameterDescriptors?[]:g.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let H=!0;const X=()=>{_.numberOfOutputs>0&&O.disconnect(M);for(let t=0,e=0;t<_.numberOfOutputs;t+=1){const n=I[t];for(let s=0;s<v[t];s+=1)M.disconnect(n,e+s,s);e+=v[t]}},Y=new Map;O.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==L){const n=h(q);for(let s=0;s<S;s+=128){for(let e=0;e<_.numberOfInputs;e+=1)for(let n=0;n<_.channelCount;n+=1)pt(t,z[e],n,n,s);void 0!==g.parameterDescriptors&&g.parameterDescriptors.forEach((({name:e},n)=>{pt(t,$,e,y+n,s)}));for(let t=0;t<_.numberOfInputs;t+=1)for(let e=0;e<v[t];e+=1)0===G[t][e].byteLength&&(G[t][e]=new Float32Array(128));try{const t=z.map(((t,e)=>{if(n[e].size>0)return Y.set(e,S/128),t;const s=Y.get(e);return void 0===s?[]:(t.every((t=>t.every((t=>0===t))))&&(1===s?Y.delete(e):Y.set(e,s-1)),t)})),i=l(d.currentTime+s/d.sampleRate,d.sampleRate,(()=>L.process(t,G,$)));H=i;for(let t=0,n=0;t<_.numberOfOutputs;t+=1){for(let i=0;i<v[t];i+=1)dt(e,G[t],i,n+i,s);n+=v[t]}}catch(t){H=!1,q.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!H){for(let t=0;t<_.numberOfInputs;t+=1){T[t].disconnect(k[t]);for(let e=0;e<_.channelCount;e+=1)k[s].disconnect(A,e,t*_.channelCount+e)}if(void 0!==g.parameterDescriptors){const t=g.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=C[e];t.disconnect(A,0,y+e),t.stop()}}A.disconnect(O),O.onaudioprocess=null,Z?X():K();break}}}};let Z=!1;const J=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Q=()=>O.connect(J).connect(d.destination),K=()=>{O.disconnect(J),J.disconnect()};return Q(),p(q,(()=>{if(H){K(),_.numberOfOutputs>0&&O.connect(M);for(let t=0,e=0;t<_.numberOfOutputs;t+=1){const n=I[t];for(let s=0;s<v[t];s+=1)M.connect(n,e+s,s);e+=v[t]}}Z=!0}),(()=>{H&&(Q(),X()),Z=!1}))})(ds,D,At,on,jt,pn,Wt,$t,Ht,fs,Qn,_s,sn),ys=((t,e,n,s,i)=>(r,o,a,c,u,l)=>{if(null!==a)try{const e=new a(r,c,l),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=s.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},s.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=s.get(t[1]);void 0!==e&&(s.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==l.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return e.connect(t).connect(r.destination),i(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(t){if(11===t.code)throw s();throw t}var h,p;if(void 0===u)throw s();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(l),e(r,o,u,l)})(At,vs,Wt,Ht,sn),ws=((t,e,n,s,i,r,o,a,c,u,l,h,p,d,m,f)=>(g,_,v)=>{const y=new WeakMap;let w=null;return{render(b,x){a(x,b);const T=y.get(x);return void 0!==T?Promise.resolve(T):(async(a,b)=>{let x=l(a),T=null;const k=I(x,b),C=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=C.reduce(((t,e)=>t+e),0),n=i(b,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let t=0;t<a.numberOfOutputs;t+=1)r.push(s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:C[t]}));const u=o(b,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});u.connect=e.bind(null,r),u.disconnect=c.bind(null,r),T=[n,r,u]}else k||(x=new h(b,g));if(y.set(b,null===T?x:T[2]),null!==T){if(null===w){if(void 0===v)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length,n=t+e,c=async()=>{const c=new p(n,128*Math.ceil(a.context.length/128),b.sampleRate),u=[],l=[];for(let t=0;t<_.numberOfInputs;t+=1)u.push(o(c,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),l.push(i(c,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(c,t,e.offset),e}))),g=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){u[t].connect(l[t]);for(let e=0;e<_.channelCount;e+=1)l[t].connect(g,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(c.destination),await Promise.all(u.map((t=>m(a,c,t)))),f(c)};w=ft(a,0===n?null:await c(),b,_,C,v,u)}const t=await w,e=n(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,l,h]=T;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=l[t];for(let s=0;s<C[t];s+=1)c.connect(n,e+s,s);e+=C[t]}return h}if(k)for(const[e,n]of a.parameters.entries())await t(b,n,x.parameters.get(e));else for(const[t,e]of a.parameters.entries())await d(b,e,x.parameters.get(t));return await m(a,b,x),x})(b,x)}}})($e,ds,He,on,jt,pn,Wt,ms,fs,Qn,tt,Ne,Ce,Xe,be,An),bs=(t=>e=>t.get(e))(Kn),xs=(t=>(e,n)=>{t.set(e,n)})(gs),Ts=Jn?((t,e,n,s,i,r,o,a,c,u,l,h,p,d)=>class extends e{constructor(e,l,p){var d;const f=a(e),g=c(f),_=(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))}))({...ht,...p});(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}})(_);const v=m.get(f),y=null==v?void 0:v.get(l),w=g||"closed"!==f.state?f:null!==(d=o(f))&&void 0!==d?d:f,b=i(w,g?null:e.baseLatency,u,l,y,_);super(e,!0,b,g?s(l,_,y):null);const x=[];b.parameters.forEach(((t,e)=>{const s=n(this,g,t);x.push([e,s])})),this._nativeAudioWorkletNode=b,this._onprocessorerror=null,this._parameters=new lt(x),g&&t(f,this);const{activeInputs:T}=r(this);h(b,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(ps,Pe,Ze,ws,ys,F,bs,Te,Ae,Ne,0,xs,0,ue):void 0,ks=((t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(e){if("SyntaxError"===e.name)throw t();throw e}})(Ht,Ce),Cs=((t,e,n,s,i,r,o,a)=>(c,u)=>n(c).render(c,u).then((()=>Promise.all(Array.from(s(u)).map((t=>n(t).render(t,u)))))).then((()=>i(u))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),N(n)):e(r,(()=>r(n)))||a(n),t.add(n),n))))(qe,fe,we,hs,An,E,Be,Le),As=((t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"==typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:c}={...Xt,...r},u=s(a,o,c);e(Et,(()=>Et(u)))||u.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(u.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(u,a),this._length=o,this._nativeOfflineAudioContext=u,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,L(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(is,fe,At,ks,Cs),Ss=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(h,Ie),Os=((t,e)=>n=>t.has(n)||e(n))(c,Ee),Ms=((t,e)=>n=>t.has(n)||e(n))(l,De),Is=((t,e)=>n=>{const s=t.get(n);return e(s)||e(n)})(h,Ae);function Es(t){return void 0===t}function Ds(t){return void 0!==t}function Ns(t){return"number"==typeof t}function Ps(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Rs(t){return Array.isArray(t)}function Vs(t){return"string"==typeof t}function qs(t){return Vs(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function Us(t,e){if(!t)throw new Error(e)}function Fs(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function js(t){t.isOffline||"running"===t.state||Gs('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Bs=!1,Ls=!1;function Ws(t){Bs=t}let zs=console;function Gs(...t){zs.warn(...t)}const $s="object"==typeof self?self:null,Hs=$s&&($s.hasOwnProperty("AudioContext")||$s.hasOwnProperty("webkitAudioContext"));function Xs(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function Ys(t,e,n,s){return new(n||(n=Promise))((function(i,r){function o(t){try{c(s.next(t))}catch(t){r(t)}}function a(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((s=s.apply(t,e||[])).next())}))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;class Zs{constructor(t,e,n,s){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(s||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),"worker"===this._type&&(null===(e=this._worker)||void 0===e||e.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Js(t){return Ms(t)}function Qs(t){return Os(t)}function Ks(t){return Is(t)}function ti(t){return Ss(t)}function ei(t,e){return"value"===t||Js(e)||Qs(e)||function(t){return t instanceof We}(e)}function ni(t,...e){if(!e.length)return t;const n=e.shift();if(Ps(t)&&Ps(n))for(const e in n)ei(e,n[e])?t[e]=n[e]:Ps(n[e])?(t[e]||Object.assign(t,{[e]:{}}),ni(t[e],n[e])):Object.assign(t,{[e]:n[e]});return ni(t,...e)}function si(t,e,n=[],s){const i={},r=Array.from(e);if(Ps(r[0])&&s&&!Reflect.has(r[0],s)&&(Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(ni(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())),1===r.length&&Ps(r[0]))ni(i,r[0]);else for(let t=0;t<n.length;t++)Ds(r[t])&&(i[n[t]]=r[t]);return ni(t,i)}function ii(t,e){return Es(t)?e:t}function ri(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}class oi{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||$s&&this.toString()===$s.TONE_DEBUG_CLASS)&&function(...t){zs.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}oi.version=i;const ai=1e-6;function ci(t,e){return t>e+ai}function ui(t,e){return ci(t,e)||hi(t,e)}function li(t,e){return t+ai<e}function hi(t,e){return Math.abs(t-e)<ai}class pi extends oi{constructor(){super(),this.name="Timeline",this._timeline=[];const t=si(pi.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Us(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Us(ui(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(hi(this._timeline[e].time,t)){for(let n=e;n>=0&&hi(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&ui(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(hi(r[e],t)){for(let n=s;n<this._timeline.length&&hi(this._timeline[n][e],t);n++)s=n;return s}if(li(r[e],t)&&ci(o[e],t))return s;ci(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&hi(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0&&hi(this._timeline[e].time,t);e--)s=e;this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const di=[];function mi(t){di.push(t)}const fi=[];function gi(t){fi.push(t)}class _i extends oi{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Es(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((t=>{if(Es(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Es(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(_i.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class vi extends _i{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class yi extends vi{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new pi,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=si(yi.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=(null===(t=arguments[0])||void 0===t?void 0:t.latencyHint)||""):(this._context=function(t){return new ls(t)}({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new Zs(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[(null===(e=arguments[0])||void 0===e?void 0:e.hasOwnProperty("updateInterval"))?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,di.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return Us(ti(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return Us(ti(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return Us(ti(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Us(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Us(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Us(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Us(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Us(Ds(Ts),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(null==$s?void 0:$s.BaseAudioContext)?null==$s?void 0:$s.AudioWorkletNode:Ts)(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t){return Ys(this,void 0,void 0,(function*(){Us(Ds(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise}))}workletsAreReady(){return Ys(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return ti(this._context)?this._context.resume():Promise.resolve()}close(){return Ys(this,void 0,void 0,(function*(){var t;ti(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(t=this,fi.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this.close(),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}function wi(t,e){Rs(e)?e.forEach((e=>wi(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function bi(t,e){Rs(e)?e.forEach((e=>bi(t,e))):Object.defineProperty(t,e,{writable:!0})}const xi=()=>{};class Ti extends oi{constructor(){super(),this.name="ToneAudioBuffer",this.onload=xi;const t=si(Ti.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,Vs(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:xi,onload:xi,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Si().sampleRate}set(t){return t instanceof Ti?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Ys(this,void 0,void 0,(function*(){const e=Ti.load(t).then((t=>{this.set(t),this.onload(this)}));Ti.downloads.push(e);try{yield e}finally{const t=Ti.downloads.indexOf(e);Ti.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Rs(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=Si(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)r.copyToChannel(o[t],t);return this._buffer=r,this}toMono(t){if(Ns(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Ns(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){Us(this.loaded,"Buffer is not loaded");const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);Us(n<s,"The start time must be less than the end time");const i=s-n,r=Si().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,s),t);return new Ti(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new Ti).fromArray(t)}static fromUrl(t){return Ys(this,void 0,void 0,(function*(){const e=new Ti;return yield e.load(t)}))}static load(t){return Ys(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if(Ti.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===Ti.baseUrl||Ti.baseUrl.endsWith("/")?Ti.baseUrl:Ti.baseUrl+"/",s=document.createElement("a");s.href=n+t,s.pathname=(s.pathname+s.hash).split("/").map(encodeURIComponent).join("/");const i=yield fetch(s.href);if(!i.ok)throw new Error(`could not load url: ${t}`);const r=yield i.arrayBuffer();return yield Si().decodeAudioData(r)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return Ys(this,void 0,void 0,(function*(){for(yield Promise.resolve();Ti.downloads.length;)yield Ti.downloads[0]}))}}Ti.baseUrl="",Ti.downloads=[];class ki extends yi{constructor(){var t,e,n;super({clockSource:"offline",context:Ks(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new As(t,e,n)),lookAhead:0,updateInterval:Ks(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Ks(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Ys(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(){return Ys(this,arguments,void 0,(function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Ti(e)}))}close(){return Promise.resolve()}}const Ci=new class extends vi{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t){return Ys(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let Ai=Ci;function Si(){return Ai===Ci&&Hs&&function(t,e=!1){e&&Ai.dispose(),Ai=ti(t)?new yi(t):Ks(t)?new ki(t):t}(new yi),Ai}if($s&&!$s.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}${i} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Oi(t){return Math.pow(2,t/12)}let Mi=440;function Ii(t){return Math.round(Ei(t))}function Ei(t){return 69+12*Math.log2(t/Mi)}class Di extends oi{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Di&&this.fromType(this._val),Es(this._val))return this._noArg();if(Vs(this._val)&&Es(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Ps(this._val)){let t=0;for(const e in this._val)if(Ds(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Ds(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Vs(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Ni extends Di{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Ni(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){const n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],s=new Ni(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new Ni(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();return i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3))),[n,e,s].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Ii(this.toFrequency())}_now(){return this.context.now()}}class Pi extends Ni{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Mi}static set A4(t){!function(t){Mi=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Pi.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const n=Ri[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:Pi.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new Pi(this.context,this.valueOf()*Oi(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return Ii(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Pi.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);return s<0&&(n+=-12*s),Vi[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return function(t){return Mi*Math.pow(2,(t-69)/12)}(t)}static ftom(t){return Ii(t)}}const Ri={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Vi=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class qi extends Ni{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Ui extends oi{constructor(){super();const t=si(Ui.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Si()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return function(t){Es(t)&&Bs&&!Ls&&(Ls=!0,Gs("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}(t),new Ni(this.context,t).toSeconds()}toFrequency(t){return new Pi(this.context,t).toFrequency()}toTicks(t){return new qi(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Es(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Ds(n)&&Ds(n.value)&&Ds(n.setValueAtTime)?t[e]=n.value:n instanceof Ui?t[e]=n._getPartialProperties(t[e]):Rs(n)||Ns(n)||Vs(n)||"boolean"==typeof n?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Ds(this[e])&&(this[e]&&Ds(this[e].value)&&Ds(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Ui?this[e].set(t[e]):this[e]=t[e])})),this}}class Fi extends pi{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return Fs(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}}class ji extends Ui{constructor(){const t=si(ji.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Us(Ds(t.param)&&(Js(t.param)||t.param instanceof ji),"param must be an AudioParam");!Js(t.param);)t.param=t.param._param;this._swappable=!!Ds(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new pi(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Ds(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ui.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Ds(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Ds(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Ds(this.maxValue)&&Ds(this.minValue)&&Fs(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return Us(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return Us(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=hi(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return Us(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);Us(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),Us(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let n=1;n<t.length;n++){const i=this._fromType(t[n])*s;this.linearRampToValueAtTime(this._toType(i),e+n*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Us(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Us(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&hi(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Us(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class Bi extends Ui{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Ds(this.input)?Js(this.input)||this.input instanceof ji?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ds(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Ds(t)&&(t instanceof Bi||Qs(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Us(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Wi(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Gs("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return function(t,e,n=0,s=0){if(Ds(e))for(;e instanceof Bi;)e=e.input;for(;!Qs(t);)Ds(t.output)&&(t=t.output);Js(e)?t.disconnect(e,n):Qs(e)?t.disconnect(e,n,s):t.disconnect()}(this,t,e,n),this}chain(...t){return Li(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Ds(this.input)&&(this.input instanceof Bi?this.input.dispose():Qs(this.input)&&this.input.disconnect()),Ds(this.output)&&(this.output instanceof Bi?this.output.dispose():Qs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Li(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Bi?t.connect(e):Qs(t)&&Wi(t,e),e)),e)}function Wi(t,e,n=0,s=0){for(Us(Ds(t),"Cannot connect from undefined node"),Us(Ds(e),"Cannot connect to undefined node"),(e instanceof Bi||Qs(e))&&Us(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Us(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Bi||e instanceof ji;)Ds(e.input)&&(e=e.input);for(;t instanceof Bi;)Ds(t.output)&&(t=t.output);Js(e)?t.connect(e,n):t.connect(e,n,s)}class zi extends Bi{constructor(){const t=si(zi.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new ji({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),wi(this,"gain")}static getDefaults(){return Object.assign(Bi.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Gi extends Bi{constructor(t){super(t),this.onended=xi,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new zi({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(Bi.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:xi})}_startGain(t,e=1){Us(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Us(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==xi&&(this.onended(this),this.onended=xi,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Us(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=xi,this}}class $i extends Gi{constructor(){const t=si($i.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Wi(this._source,this._gainNode),this.offset=new ji({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Gi.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Hi extends Bi{constructor(){const t=si(Hi.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new $i({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Bi.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Xi(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Xi(t,e,n,s){(e instanceof ji||Js(e)||e instanceof Hi&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Hi&&(e.overridden=!0)),Wi(t,e,n,s)}class Yi extends ji{constructor(){const t=si(Yi.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new pi(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(ji.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let t=0;t<=r;t++){const r=n*t+e,o=this._exponentialApproach(i.time,i.value,s,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let t=0;t<=i;t++){const i=r*t+s.time,o=this._exponentialInterpolate(s.time,s.value,e,n,i);this.linearRampToValueAtTime(this._toType(o),i)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Es(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-e.time),r=Math.sqrt(Math.pow(s,2)-2*i*(e.ticks-t)),o=(-s+r)/i;return(o>0?o:(-s-r)/i)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Zi extends Hi{constructor(){const t=si(Zi.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new Yi({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Hi.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Ji extends Ui{constructor(){const t=si(Ji.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new Fi,this._tickOffset=new pi,this._ticksAtTime=new pi,this._secondsAtTime=new pi,this.frequency=new Zi({context:this.context,units:t.units,value:t.frequency}),wi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Ui.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Ds(e)&&this.setTicksAtTime(e,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s=this._ticksAtTime.get(e),i={state:"paused",time:e};this._state.add(i);let r=s||n,o=s?s.ticks:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,(t=>{let e=r.time;const n=this._tickOffset.get(t.time);n&&n.time>=r.time&&(o=n.ticks,e=n.time),"started"===r.state&&"started"!==t.state&&(o+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e),t.time!==i.time&&(a={state:t.state,time:t.time,ticks:o})),r=t})),this._state.remove(i),a&&this._ticksAtTime.add(a),o}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);const s=this._secondsAtTime.get(t);let i=s||e,r=s?s.seconds:0,o=null;return this._state.forEachBetween(i.time,t+this.sampleTime,(t=>{let e=i.time;const s=this._tickOffset.get(t.time);s&&s.time>=i.time&&(r=s.seconds,e=s.time),"started"===i.state&&"started"!==t.state&&(r+=t.time-e,t.time!==n.time&&(o={state:t.state,time:t.time,seconds:r})),i=t})),this._state.remove(n),o&&this._secondsAtTime.add(o),r}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,t),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(a)-a;c=hi(c,1)?0:c;let u=this.frequency.getTimeOfTick(o+c);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(t){i=t;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Qi extends Ui{constructor(){const t=si(Qi.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=xi,this._lastUpdate=0,this._state=new Fi("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new Ji({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,wi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Ui.getDefaults(),{callback:xi,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){js(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}_i.mixin(Qi);class Ki extends Bi{constructor(){const t=si(Ki.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new zi({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,wi(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(Bi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class tr extends Bi{constructor(){const t=si(tr.getDefaults(),arguments);super(t),this.name="Destination",this.input=new Ki({context:this.context}),this.output=new zi({context:this.context}),this.volume=this.input.volume,Li(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Bi.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Li(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}mi((t=>{t.destination=new tr({context:t})})),gi((t=>{t.destination.dispose()}));class er extends Bi{constructor(){super(...arguments),this.name="Listener",this.positionX=new ji({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ji({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ji({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ji({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ji({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ji({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ji({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ji({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ji({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Bi.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}mi((t=>{t.listener=new er({context:t})})),gi((t=>{t.listener.dispose()}));class nr extends oi{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=si(nr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:xi,onload:xi,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Us(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=xi,s=xi){return Vs(e)?(this.baseUrl&&"data:audio/"===e.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(t.toString(),new Ti(this.baseUrl+e,n,s))):this._buffers.set(t.toString(),new Ti(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class sr extends qi{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class ir extends Ui{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new pi,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}mi((t=>{t.draw=new ir({context:t})})),gi((t=>{t.draw.dispose()}));class rr extends oi{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Us(Ds(t.time),"Events must have a time property"),Us(Ds(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new or(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class or{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class ar extends oi{constructor(t){super(),this.name="TimelineValue",this._timeline=new pi({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class cr extends Bi{constructor(){super(si(cr.getDefaults(),arguments,["context"]))}connect(t,e=0,n=0){return Xi(this,t,e,n),this}}class ur extends cr{constructor(){const t=si(ur.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Rs(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Hi.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Us(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class lr extends cr{constructor(){const t=si(lr.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new ur({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(cr.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class hr{constructor(t,e){this.id=hr._eventId++,this._remainderTime=0;const n=Object.assign(hr.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:xi,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}hr._eventId=0;class pr extends hr{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(pr.getDefaults(),e);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},hr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return li(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new sr(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){li(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new sr(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);ci(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class dr extends Ui{constructor(){const t=si(dr.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new ar(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new pi,this._repeatedEvents=new rr,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new Qi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),wi(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Ui.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new sr(this.context,2*this._swingTicks/3).toSeconds()*s}Ws(!0),this._timeline.forEachAtTime(e,(e=>e.invoke(t))),Ws(!1)}schedule(t,e){const n=new hr(this,{callback:t,time:new qi(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new pr(this,{callback:t,duration:new Ni(this.context,s).toTicks(),interval:new Ni(this.context,e).toTicks(),time:new qi(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new hr(this,{callback:t,once:!0,time:new qi(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new sr(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return this.context.resume(),Ds(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Rs(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Ni(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Ni(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new sr(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new sr(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){const n=this.now();let s=this.bpm,i=1/(60/s.getValueAtTime(n)/this.PPQ),r=[];if("time"===t.units){const t=1/64/i,e=new zi(t),n=new lr(-1),o=new zi(t);s.chain(e,n,o),s=o,i=1/i,r=[e,n,o]}e||(e=0!==t.getValueAtTime(n)?t.getValueAtTime(n)/i:0);const o=new zi(e);return s.connect(o),o.connect(t._param),r.push(o),this._syncedSignals.push({initial:t.value,nodes:r,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.nodes.forEach((t=>t.dispose())),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),bi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}_i.mixin(dr),mi((t=>{t.transport=new dr({context:t})})),gi((t=>{t.transport.dispose()}));class mr extends Bi{constructor(t){super(t),this.input=void 0,this._state=new Fi("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=xi,this._syncedStop=xi,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Ki({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,wi(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(Bi.getDefaults(),{mute:!1,onstop:xi,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=Es(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(ii(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else js(this.context),this._start(s,e,n);else Us(ci(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=Es(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Ds(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(ci(e,0)){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=xi,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class fr extends Gi{constructor(){const t=si(fr.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Wi(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ji({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Ti(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Gi.getDefaults(),{url:new Ti,loop:!1,loopEnd:0,loopStart:0,onload:xi,onerror:xi,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){Us(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?ii(e,this.loopStart):ii(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;ui(r,t)&&(r=(r-e)%n+e),hi(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,li(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),Ds(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function gr(t,e){return Ys(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new ki(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)}))}class _r extends Gi{constructor(){const t=si(_r.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Wi(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new ji({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new ji({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),wi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Gi.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class vr extends mr{constructor(){const t=si(vr.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new Hi({context:this.context,units:"frequency",value:t.frequency}),wi(this,"frequency"),this.detune=new Hi({context:this.context,units:"cents",value:t.detune}),wi(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(mr.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new _r({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return vr._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}));{const t=vr._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Ds(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),vr._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),vr._periodicWaveCache.length>100&&vr._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Fs(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[s,i]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(s[o]=-a*Math.sin(e*o),i[o]=a*Math.cos(e*o)):(s[o]=0,i[o]=0)}return[s,i]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let i=0;i<32;i++)n=Math.max(this._inverseFFT(t,e,i/32*s),n);return i=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(i,o),r);var i,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}vr._periodicWaveCache=[];class yr extends cr{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ur({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class wr extends Hi{constructor(){const t=si(wr.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new zi({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Hi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class br extends mr{constructor(){const t=si(br.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new yr({context:this.context}),this._modulationNode=new zi({context:this.context}),this._carrier=new vr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new vr({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new wr({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),wi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(vr.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class xr extends mr{constructor(){const t=si(xr.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new zi({context:this.context,gain:0}),this._carrier=new vr({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Hi({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new vr({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new wr({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new wr({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),wi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(vr.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Tr extends mr{constructor(){const t=si(Tr.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new zi({context:this.context,gain:0}),this._thresh=new ur({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new Hi({context:this.context,units:"audioRange",value:t.width}),this._triangle=new vr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),wi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(mr.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class kr extends mr{constructor(){const t=si(kr.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new Hi({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Hi({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,wi(this,["frequency","detune"])}static getDefaults(){return Object.assign(vr.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(Fs(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new vr({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):xi});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class Cr extends mr{constructor(){const t=si(Cr.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new wr({context:this.context,value:2}),this._pulse=new Tr({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new vr({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),wi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(mr.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ar={am:br,fat:kr,fm:xr,oscillator:vr,pulse:Tr,pwm:Cr};class Sr extends mr{constructor(){const t=si(Sr.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new Hi({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Hi({context:this.context,units:"cents",value:t.detune}),wi(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(vr.getDefaults(),xr.getDefaults(),br.getDefaults(),kr.getDefaults(),Tr.getDefaults(),Cr.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Ar[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Ar[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Ns(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Ns(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Vs(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){return gr(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function Or(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Fs(s,t,e),n.set(this,s)}})}}function Mr(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Fs(this.toSeconds(s),t,e),n.set(this,s)}})}}class Ir extends mr{constructor(){const t=si(Ir.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new Ti({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(mr.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:xi,onerror:xi,playbackRate:1,reverse:!1})}load(t){return Ys(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=xi){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?ii(e,this._loopStart):ii(e,0);const s=this.toSeconds(e),i=n;n=ii(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new fr({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Es(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){var s;null===(s=[...this._activeSources].pop())||void 0===s||s.stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Fs(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Fs(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Xs([Mr(0)],Ir.prototype,"fadeIn",void 0),Xs([Mr(0)],Ir.prototype,"fadeOut",void 0);class Er extends cr{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new ur({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Dr extends Bi{constructor(){const t=si(Dr.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new Hi({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Bi.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Vs(t))return t;{let n;for(n in Nr)if(Nr[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Vs(n)&&Reflect.has(Nr,n)){const s=Nr[n];Ps(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!Rs(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0&&(n=(1-i)/(1/n)),n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let s=this._attackCurve;for(let t=1;t<s.length;t++)if(s[t-1]<=i&&i<=s[t]){s=this._attackCurve.slice(t),s[0]=i;break}this._sig.setValueCurveAtTime(s,t,n,e)}if(s&&this.sustain<1){const i=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+r):this._sig.exponentialApproachValueAtTime(i,r,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Us(Rs(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Xi(this,t,e,n),this}asArray(){return Ys(this,arguments,void 0,(function*(t=1024){const e=t/this.context.sampleRate,n=new ki(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));return a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0),(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Xs([Mr(0)],Dr.prototype,"attack",void 0),Xs([Mr(0)],Dr.prototype,"decay",void 0),Xs([Or(0,1)],Dr.prototype,"sustain",void 0),Xs([Mr(0)],Dr.prototype,"release",void 0);const Nr=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=t/10+.83*n}i[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,s=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(s*(1-n))}function c(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:c(a),Out:a},cosine:{In:s,Out:(u=s,u.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:c(i)},sine:{In:o,Out:c(o)},step:{In:r,Out:c(r)}};var u})();class Pr extends Bi{constructor(){const t=si(Pr.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new Ki({context:this.context,volume:t.volume}),this.volume=this._volume.volume,wi(this,"volume")}static getDefaults(){return Object.assign(Bi.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Rr extends Pr{constructor(){const t=si(Rr.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Pr.getDefaults(),{detune:0,onsilence:xi,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof Pi?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Xs([Mr(0)],Rr.prototype,"portamento",void 0);class Vr extends Dr{constructor(){super(si(Vr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new zi({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class qr extends Rr{constructor(){const t=si(qr.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new Sr(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Vr(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),wi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Rr.getDefaults(),{envelope:Object.assign(ri(Dr.getDefaults(),Object.keys(Bi.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(ri(Sr.getDefaults(),[...Object.keys(mr.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Ur extends qr{constructor(){const t=si(Ur.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,wi(this,["oscillator","envelope"])}static getDefaults(){return ni(Rr.getDefaults(),qr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof Pi?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Xs([Or(0)],Ur.prototype,"octaves",void 0),Xs([Mr(0)],Ur.prototype,"pitchDecay",void 0);const Fr=new Set;function jr(t){Fr.add(t)}function Br(t,e){const n=`registerProcessor("${t}", ${e})`;Fr.add(n)}class Lr extends Bi{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=xi;const e=URL.createObjectURL(new Blob([Array.from(Fr).join("\n")],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}jr('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),jr("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),jr("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Br("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Wr extends Pr{constructor(){const t=si(Wr.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(Us(qs(n)||Ns(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),qs(n)){const s=new Pi(this.context,n).toMidi();e[s]=t.urls[n]}else Ns(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new nr({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Pr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:xi,onerror:xi,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=Ei(new Pi(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,c=this._buffers.get(a),u=Oi(o+r),l=new fr({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);l.start(e,0,c.duration/u,n),Rs(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Pi(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;)t.shift().stop(e)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),Rs(e)?(Us(Rs(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(Us(qs(t)||isFinite(t),`note must be a pitch or midi: ${t}`),qs(t)){const s=new Pi(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Xs([Mr(0)],Wr.prototype,"attack",void 0),Xs([Mr(0)],Wr.prototype,"release",void 0);class zr extends Bi{constructor(){const t=si(zr.getDefaults(),arguments,["fade"]);super(t),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Er({context:this.context}),this.a=new zi({context:this.context,gain:0}),this.b=new zi({context:this.context,gain:0}),this.output=new zi({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Hi({context:this.context,units:"normalRange",value:t.fade}),wi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Wi(this._split,this.a.gain,0),Wi(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Bi.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Gr extends Bi{constructor(t){super(t),this.name="Effect",this._dryWet=new zr({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new zi({context:this.context}),this.effectReturn=new zi({context:this.context}),this.input=new zi({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],wi(this,"wet")}static getDefaults(){return Object.assign(Bi.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class $r extends Bi{constructor(){const t=si($r.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new ji({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",wi(this,"pan")}static getDefaults(){return Object.assign(Bi.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Hr="bit-crusher";Br(Hr,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class Xr extends Gr{constructor(){const t=si(Xr.getDefaults(),arguments,["bits"]);super(t),this.name="BitCrusher",this._bitCrusherWorklet=new Yr({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(Gr.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class Yr extends Lr{constructor(){const t=si(Yr.getDefaults(),arguments);super(t),this.name="BitCrusherWorklet",this.input=new zi({context:this.context}),this.output=new zi({context:this.context}),this.bits=new ji({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Lr.getDefaults(),{bits:12})}_audioWorkletName(){return Hr}onReady(t){Li(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Zr extends Bi{constructor(){const t=si(Zr.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new zi({context:this.context}),Zr._allSolos.has(this.context)||Zr._allSolos.set(this.context,new Set),Zr._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(Bi.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),Zr._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){Zr._soloed.has(this.context)||Zr._soloed.set(this.context,new Set),Zr._soloed.get(this.context).add(this)}_removeSolo(){Zr._soloed.has(this.context)&&Zr._soloed.get(this.context).delete(this)}_isSoloed(){return Zr._soloed.has(this.context)&&Zr._soloed.get(this.context).has(this)}_noSolos(){return!Zr._soloed.has(this.context)||Zr._soloed.has(this.context)&&0===Zr._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Zr._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Zr._allSolos=new Map,Zr._soloed=new Map;class Jr extends Bi{constructor(){const t=si(Jr.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new $r({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Ki({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,wi(this,["pan","volume"])}static getDefaults(){return Object.assign(Bi.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Qr extends Bi{constructor(){const t=si(Qr.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new Zr({solo:t.solo,context:this.context}),this._panVol=this.output=new Jr({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),wi(this,["pan","volume"])}static getDefaults(){return Object.assign(Bi.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Qr.buses.has(t)||Qr.buses.set(t,new zi({context:this.context})),Qr.buses.get(t)}send(t,e=0){const n=this._getBus(t),s=new zi({context:this.context,units:"decibels",gain:e});return this.connect(s),s.connect(n),s}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Qr.buses=new Map;const Kr=Si().transport;Si().destination,Si().destination,Si().listener,Si().draw,Si();var to=n(748);const eo=document.getElementById("spacepatrolContainer");let no,so;eo.setAttribute("tabIndex","0"),eo.style.position="fixed",eo.style.width=`${window.innerWidth}px`,eo.style.height=`${window.innerHeight}px`;const io=new class{_htmlElement;_knobElement;_value=new e;_isTouched=!1;touchEndObservers=[];constructor(){this._htmlElement=document.createElement("div"),this._htmlElement.setAttribute("style","width: 200px; \n                                                        height: 200px; \n                                                        background-color: gray; \n                                                        opacity: .5;\n                                                        border-radius: 50%; \n                                                        position: absolute;\n                                                        bottom: 20px;\n                                                        left: 10px;"),this._knobElement=document.createElement("div"),this._knobElement.setAttribute("style","width: 50px;\n                                                height: 50px;\n                                                background-color: darkgray;\n                                                border-radius: 50%;\n                                                position: absolute;\n                                                top: 50%;\n                                                left: 50%;\n                                                transform: translate(-50%, -50%);\n                                                "),this._htmlElement.appendChild(this._knobElement),this.initEvents()}addObserver(t){this.touchEndObservers.push(t)}get htmlElement(){return this._htmlElement}get isTouched(){return this._isTouched}get knobElement(){return this._knobElement}get value(){return this._value}initEvents(){this._knobElement.addEventListener("touchstart",this.onTouchStart.bind(this)),this._knobElement.addEventListener("touchmove",this.onTouchMove.bind(this)),this._knobElement.addEventListener("touchend",this.onTouchEnd.bind(this))}onTouchStart(t){this._isTouched=!0,t.preventDefault()}onTouchMove(t){t.preventDefault();const n=t.touches[0],s=n.clientX-this._htmlElement.getBoundingClientRect().left,i=n.clientY-this._htmlElement.getBoundingClientRect().top,r=this._htmlElement.offsetWidth/2,o=this._htmlElement.offsetHeight/2,a=Math.sqrt((s-r)**2+(i-o)**2),c=a/r,u=Math.atan2(i-o,s-r);if(a<=r)this._knobElement.style.left=`${s}px`,this._knobElement.style.top=`${i}px`;else{const t=r+r*Math.cos(u),e=o+o*Math.sin(u);this._knobElement.style.left=`${t}px`,this._knobElement.style.top=`${e}px`}this._value=e.fromLengthAndAngle(c/10,u/Math.PI*180)}onTouchEnd(t){t.preventDefault(),this._isTouched=!1,this._knobElement.style.left="50%",this._knobElement.style.top="50%",this._value=new e(0,0),this.touchEndObservers.forEach((t=>t()))}};eo.appendChild(io.htmlElement);const ro=document.createElement("select"),oo=document.createElement("option"),ao=document.createElement("option"),co=document.createElement("option"),uo=document.createElement("option"),lo=document.createElement("option"),ho=document.createElement("option"),po=document.createElement("option"),mo=document.createElement("option"),fo=document.createElement("option"),go=document.createElement("option"),_o=document.createElement("option"),vo=document.createElement("option");ro.appendChild(oo),ro.appendChild(ao),ro.appendChild(co),ro.appendChild(uo),ro.appendChild(lo),ro.appendChild(ho),ro.appendChild(po),ro.appendChild(mo),ro.appendChild(fo),ro.appendChild(go),ro.appendChild(_o),ro.appendChild(vo),oo.setAttribute("value","rainbowRocket"),oo.innerHTML="disabled selected",ao.setAttribute("value","rokket"),co.setAttribute("value","rainbowRocket"),uo.setAttribute("value","../resources/bromber.svg"),lo.setAttribute("value","../resources/blizzer.png"),ho.setAttribute("value","../resources/flipps.svg"),po.setAttribute("value","../resources/lopman.png"),mo.setAttribute("value","../resources/helgram1.png"),fo.setAttribute("value","../resources/carrot.svg"),go.setAttribute("value","../resources/rock.svg"),_o.setAttribute("value","../resources/rocket.svg"),vo.setAttribute("value","../resources/eye.svg"),oo.textContent="Chose your vessel",ao.textContent="rokket",co.textContent="rainbowRocket",uo.textContent="bromber",lo.textContent="blizzer",ho.textContent="flipps",po.textContent="lopman",mo.textContent="helgram",fo.textContent="carrot",go.textContent="rock",_o.textContent="rocket",vo.textContent="eye";const yo=document.createElement("select"),wo=document.createElement("option"),bo=document.createElement("option"),xo=document.createElement("option"),To=document.createElement("option");yo.appendChild(wo),yo.appendChild(bo),yo.appendChild(xo),yo.appendChild(To),wo.setAttribute("value","brown"),bo.setAttribute("value","goldenrod"),xo.setAttribute("value","beige"),To.setAttribute("value","lightblue"),wo.textContent="brown",bo.textContent="goldenrod",xo.textContent="beige",To.textContent="fln";const ko=document.createElement("input");ko.setAttribute("type","text"),ko.setAttribute("placeholder","enter your id");const Co=document.createElement("button");Co.textContent="Start Game",Co.addEventListener("click",(async function(){Uo=!1,console.log(`Commander ${ko.value}, you depart in a ${qo} ${ro.value}. Game starts now!`);try{let t=await Promise.resolve().then((function(){var t=new Error("Cannot find module './library.js'");throw t.code="MODULE_NOT_FOUND",t}));eo.innerHTML="",eo.offsetWidth&&eo.offsetHeight?(console.log("gameFrame sized!"),t.initGame(eo,ro.value,qo,ko.value)):console.log("Error getting gameFrame size!")}catch(t){console.error("Error loading library:",t)}}));const Ao=document.createElement("select"),So=document.createElement("option");So.innerHTML="disabled selected";const Oo=document.createElement("option"),Mo=document.createElement("option"),Io=document.createElement("option");Ao.appendChild(So),Ao.appendChild(Oo),Ao.appendChild(Mo),Ao.appendChild(Io),So.setAttribute("value","../resources/letusprogresstothecastleoffunk.mp3"),Oo.setAttribute("value","../resources/letusprogress.mp3"),Mo.setAttribute("value","../resources/letusprogress.mp3"),Io.setAttribute("value","../resources/letusprogress.mp3"),So.textContent="Chose music",Oo.textContent="Let us progress to funk",Mo.textContent="Hear me",Io.textContent="wonderwale";const Eo=document.createElement("button");Eo.textContent="Play Audio",Eo.addEventListener("click",(()=>{Ao.value.endsWith(".mp3")?function(){so||(so=new window.AudioContext),fetch(Ao.value).then((t=>t.arrayBuffer())).then((t=>{if(so)return so.decodeAudioData(t)})).then((t=>{t&&(no=t)})).catch((t=>{console.error("Error loading audio file:",t)}));const t=so.createBufferSource();t.buffer=no,t.connect(so.destination),t.start(0)}():Ao.value.endsWith(".mid")?async function(){try{const t=await fetch(Ao.value),e=await t.arrayBuffer(),n=new to.Midi(e),s=new Xr(4).toDestination(),i=new qr({oscillator:{type:"square"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}}).connect(s);n.tracks.forEach((t=>{t.notes.forEach((t=>{i.triggerAttackRelease(t.name,t.duration,t.time)}))})),Kr.start()}catch(t){console.error("Error loading or playing MIDI file:",t)}}():console.log("unsupported file format")}));const Do=document.createElement("div");Do.textContent="Left Right rotate, up down zoom",eo.appendChild(ro),eo.appendChild(yo),eo.appendChild(ko),eo.appendChild(Co),eo.appendChild(Ao),eo.appendChild(Eo),eo.appendChild(Do);let No=-50,Po=-50,Ro=100,Vo=100,qo=yo.value,Uo=!0,Fo={},jo=0,Bo=0,Lo=Ro/Vo;const Wo=document.createElementNS("http://www.w3.org/2000/svg","svg");Wo.style.position="relative",window.innerWidth/window.innerHeight>=1&&(Wo.style.width=window.innerHeight.toString()),eo.appendChild(Wo),Wo.setAttribute("id","previewSvg"),Wo.setAttribute("tabindex","0"),Wo.setAttribute("viewBox",`${Po}, ${No}, ${Ro}, ${Vo}`),Wo.style.zIndex="-1",Wo.style.outline="none",Wo.appendChild(t.getCraftGElement(ro.value));const zo=new class{keysPressed={};constructor(t){eo.addEventListener("keydown",this.handleKeyDown.bind(this)),eo.addEventListener("keyup",this.handleKeyUp.bind(this))}handleKeyDown(t){this.keysPressed[t.key]=!0}handleKeyUp(t){this.keysPressed[t.key]=!1}isKeyPressed(t){return this.keysPressed[t]||!1}getKeysPressed(){return this.keysPressed}}(eo);ro.addEventListener("change",(()=>{for(;Wo.firstChild;)Wo.removeChild(Wo.firstChild);Wo.appendChild(t.getCraftGElement(ro.value)),Wo.focus()})),yo.addEventListener("change",(()=>{for(qo=yo.value;Wo.firstChild;)Wo.removeChild(Wo.firstChild);Wo.focus(),Wo.appendChild(t.getCraftGElement(ro.value))})),function t(){Uo&&(requestAnimationFrame((()=>t())),io.isTouched&&(jo=100*io.value.x,Ro+=10*io.value.y,Po=Ro/-2,Vo=Ro*Lo,No=Vo/-2,Wo.setAttribute("viewBox",`${Po}, ${No}, ${Ro}, ${Vo}`)),zo.getKeysPressed().ArrowLeft?jo-=1:zo.getKeysPressed().ArrowRight&&(jo+=1),zo.getKeysPressed().ArrowUp?(Ro+=Ro/10,Po=Ro/-2,Vo=Ro*Lo,No=Vo/-2,Wo.setAttribute("viewBox",`${Po}, ${No}, ${Ro}, ${Vo}`)):zo.getKeysPressed().ArrowDown&&(Ro-=Ro/10,Po=Ro/-2,Vo=Ro*Lo,No=Vo/-2,Wo.setAttribute("viewBox",`${Po}, ${No}, ${Ro}, ${Vo}`)),Bo+=jo,Bo=(Bo%360+360)%360,Wo.style.transform=`rotate(${Bo}deg)`,Fo.ArrowLeft||Fo.ArrowRight||(jo-=jo/100),Math.abs(jo)<.1&&(jo=0))}()})()})();